---
title: "ROS2ã‚’æ·±ãç†è§£ã™ã‚‹ï¼šãƒãƒ¼ãƒ‰ç·¨ï¼‘ã€€åŸºæœ¬æ§‹é€ "
emoji: "ğŸ“‘"
type: "tech"
topics:
  - "ros2"
  - "robot"
  - "robotics"
published: true
published_at: "2023-09-02 15:07"
---

# è§£èª¬å¯¾è±¡

:::message
ã“ã®è¨˜äº‹ã¯ROSåˆå¿ƒè€…å‘ã‘ã§ã¯ãªãã€ä¸€é€šã‚Šã®æ¦‚å¿µã¯ç†è§£ã—ãŸã®ã§ã‚¹ãƒ†ãƒƒãƒ—ã‚¢ãƒƒãƒ—ã—ãŸã„ã¨ã„ã†äººå‘ã‘ã§ã™ã€‚
:::

æœ¬è¨˜äº‹ã§ã¯ã€ROS2ã®ä¸­æ ¸æ¦‚å¿µã§ã‚ã‚‹ãƒãƒ¼ãƒ‰ã®ä¸­èº«ã®åŸºæœ¬æ§‹é€ ã«ã¤ã„ã¦è§£èª¬ã—ã¾ã™ã€‚ãƒãƒ¼ãƒ‰ã«ã¾ã¤ã‚ã‚‹è«¸æ©Ÿèƒ½ãŒã©ã®éƒ¨åˆ†ã§å®Ÿè£…ã•ã‚Œã¦ã„ã‚‹ã‹ã‚’çŸ¥ã£ã¦ã„ã‚‹ã¨ã€ã‚³ãƒ¼ãƒ‰ãƒªãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ãŒæ—ã‚Šã¾ã™ã€‚

æœ¬è¨˜äº‹ã®ç›®æ¨™ã¯ã€ä¸‹è¨˜ã®ãƒãƒ¼ãƒ‰å†…éƒ¨æ§‹é€ ã‚’ç†è§£ã™ã‚‹ã“ã¨ã§ã™

- ãƒãƒ¼ãƒ‰
  - ROS2ä¸Šã§å®Ÿè¡Œã™ã‚‹å‡¦ç†ã‚’æ‹…ã†æœ€ã‚‚åŸºæœ¬çš„ãªã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆï¼ˆè«–ç†å‡¦ç†å˜ä½ï¼‰
  - `Node`ã‚¯ãƒ©ã‚¹ãƒ»`LifecycleNode`ã‚¯ãƒ©ã‚¹åŠã³ãã‚Œã‚‰ã®æ´¾ç”Ÿã‚¯ãƒ©ã‚¹ï¼ˆc++ã‚„pythonç­‰ã®å„ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆè¨€èªã§è¡¨ç¾ã•ã‚Œã‚‹ï¼‰ã‚’ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹åŒ–ã—ã¦ç”Ÿæˆã•ã‚Œã‚‹
- rclãƒãƒ¼ãƒ‰
  - ãƒãƒ¼ãƒ‰ã®å†…éƒ¨æ§‹é€ ã§ã‚ã‚Šremapã®å‡¦ç†ãªã©åŸºæœ¬æ©Ÿèƒ½ã‚’æä¾›ã—ã¦ã„ã‚‹éƒ¨åˆ†
  - ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆè¨€èªï¼ˆc++,pythonç­‰ï¼‰ã«ä¾å­˜ã—ãªã„cã§å®Ÿè£…ã•ã‚Œã¦ã„ã‚‹
- rmwãƒãƒ¼ãƒ‰
  - rclãƒãƒ¼ãƒ‰ã®å†…éƒ¨æ§‹é€ ã§ã‚ã‚ŠDDSã¨ã„ã†é€šä¿¡è¦æ ¼ã‚’ç”¨ã„ã¦ãƒãƒ¼ãƒ‰é–“ã§äº’ã„ã«é€šä¿¡ã‚’è¡Œãˆã‚‹ã‚ˆã†ã«ã™ã‚‹æ©Ÿèƒ½ã‚’æä¾›ã—ã¦ã„ã‚‹éƒ¨åˆ†
  - ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆè¨€èªï¼ˆc++,pythonç­‰ï¼‰ã«ä¾å­˜ã—ãªã„cã§å®Ÿè£…ã•ã‚Œã¦ã„ã‚‹

æœ¬è¨˜äº‹ã¯ä¸‹è¨˜ã®ã€ŒROS2ã‚’æ·±ãç†è§£ã™ã‚‹ã€ã®è¨˜äº‹ç¾¤ã®ä¸€éƒ¨ã§ã™ãŒã€ã“ã®è¨˜äº‹å˜ç‹¬ã§ã‚‚ç†è§£ã§ãã‚‹ã‚ˆã†ã«ãªã£ã¦ã„ã¾ã™ã€‚

https://zenn.dev/uedake/articles/ros2_collection

## èª­ã‚€ã¨å½¹ã«ç«‹ã¤ã¨æ€ã‚ã‚Œã‚‹èª­è€…
- ROS2ã‚’ä½¿ç”¨ã—ãŸãƒ­ãƒœãƒƒãƒˆé–‹ç™ºã‚’å§‹ã‚ã¦æ•°ã‹æœˆãã‚‰ã„ã€ROS2ã®ä¸»è¦ãªæ¦‚å¿µã«ã¤ã„ã¦ã¯ãŠãŠã–ã£ã±ã«ã¯ç†è§£ã—ã¦ãŠã‚Šã‚¹ãƒ†ãƒƒãƒ—ã‚¢ãƒƒãƒ—ã—ãŸã„æ–¹
- ãƒãƒ¥ãƒ¼ãƒˆãƒªã‚¢ãƒ«é€šã‚Šã«ã‚„ã‚Œã°ç¢ºã‹ã«å‹•ãã‘ã©ãƒ»ãƒ»ãƒ»ã€è‡ªåˆ†ã¯ä¸é©åˆ‡ãª/å†—é•·ãªã‚³ãƒ¼ãƒ‰æ›¸ã„ã¦ã„ã‚‹ã®ã§ã¯ï¼Ÿã¨è‡ªä¿¡ãŒãªã„æ–¹
- ROS2ãŒæœŸå¾…é€šã‚Šã«å‹•ã„ã¦ãã‚Œãªã„ï¼ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆèª­ã‚“ã§ã‚‚åŸå› ãŒã‚ã‹ã‚‰ãªã„ï¼ã¨ã„ã†äºº

ROS2ã‚’ç”¨ã„ãŸé–‹ç™ºã§ã¯ã€é©åˆ‡ãªè¨­è¨ˆã‚„å•é¡Œè§£æ±ºã®ç‚ºã«é…ã‹ã‚Œæ—©ã‹ã‚Œã‚½ãƒ¼ã‚¹ã‚’è¿½ã£ã¦å‡¦ç†ã‚’ç¢ºèªã™ã‚‹ä½œæ¥­ãŒå¿…é ˆã«ãªã‚Šã¾ã™ã€‚ã‚ã‚‹ç¨‹åº¦æ¦‚å¿µã‚’æ´ã‚ãŸå¾Œã¯ã€å¿…è¦ã«æ„Ÿã˜ãŸã¨ã“ã‚ã‹ã‚‰ã©ã‚“ã©ã‚“ã‚½ãƒ¼ã‚¹ã‚’èª­ã¿å§‹ã‚ã¾ã—ã‚‡ã†ã€‚

## ã‚½ãƒ¼ã‚¹ã‚’è¦‹ã¦ç†è§£ã™ã‚‹ã¨ã‚ˆã„ãƒã‚¤ãƒ³ãƒˆ

- ãƒãƒ¼ãƒ‰åãƒ»ãƒãƒ¼ãƒ‰åå‰ç©ºé–“ã¨remapå‡¦ç†ã®ã•ã‚Œæ–¹
  - å¤§è¦æ¨¡ãªãƒ­ãƒœãƒƒãƒˆã‚·ã‚¹ãƒ†ãƒ ã‚’è¨­è¨ˆã™ã‚‹å ´åˆã«ã¯ã€å®Œå…¨ä¿®é£¾ãƒãƒ¼ãƒ‰åï¼ˆfully qualified name=ãƒãƒ¼ãƒ‰åå‰ç©ºé–“ã¨ãƒãƒ¼ãƒ‰åã‚’çµåˆã—ãŸåå‰ï¼‰ãŒè¡çªã—ãªã„ã‚ˆã†é…æ…®ãŒå¿…è¦ã§ã™ã€‚ãã®éš›ã«remapå‡¦ç†ãŒã©ã†å‹•ã„ã¦ã„ã‚‹ã®ã‹ã‚’ã—ã£ã‹ã‚Šç†è§£ã—ã¦ãŠãã¨å®‰å¿ƒã§ã™ã€‚
- ãƒãƒ¼ãƒ‰ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã®åˆæœŸå€¤è¨­å®šã®å‡¦ç†ã®ã•ã‚Œæ–¹
  - ç‹¬è‡ªãƒãƒ¼ãƒ‰ã‚’è¨­è¨ˆã™ã‚‹æ™‚ã«ã€ãƒãƒ¼ãƒ‰ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã®æ­£ã—ã„ç†è§£ã¯éå¸¸ã«é‡è¦ã§ã™ã€‚ç‰¹ã«launchãƒ•ã‚¡ã‚¤ãƒ«ã¨ãƒãƒ¼ãƒ‰ã®é–“ã®å‡¦ç†ã®ã¤ãªãŒã‚ŠãŒç†è§£ã§ãã‚‹ã¨ã€ŒROSã‚ã‹ã£ã¦ããŸæ„Ÿã€ãŒå¾—ã‚‰ã‚Œã¾ã™


# å‰æ
- ROS2 humbleæ™‚ã®å®Ÿè£…ã«åŸºã¥ã„ã¦ã„ã¾ã™ã€‚
- c++å´ã®å®Ÿè£…ï¼ˆrclcppã®[node.cpp](https://github.com/ros2/rclcpp/blob/rolling/rclcpp/src/rclcpp/node.cpp)ï¼‰ã«åŸºã¥ã„ã¦ã„ã¾ã™ãŒã€rclpyå´ã‚‚çµå±€ã¯rclã§è¦å®šã•ã‚Œã‚‹å®Ÿè£…ã«ã¤ãªãŒã‚Šã¾ã™ã®ã§ã€å¤§éƒ¨åˆ†ã¯å…±é€šã§ã™ã€‚
- ãƒãƒ¼ãƒ‰ã«ã¯ã€ãƒ©ã‚¤ãƒ•ã‚µã‚¤ã‚¯ãƒ«ã‚’æŒãŸãªã„ãƒãƒ¼ãƒ‰ï¼ˆ`rclcpp::Node`ï¼‰ã¨ãƒ©ã‚¤ãƒ•ã‚µã‚¤ã‚¯ãƒ«ã‚’æŒã¤ãƒãƒ¼ãƒ‰ï¼ˆ`rclcpp_lifecycle::LifecycleNode`ï¼‰ã®ï¼’ç¨®é¡ãŒã‚ã‚Šã¾ã™ã€‚æœ¬è¨˜äº‹ã§ã®ã‚½ãƒ¼ã‚¹ã‚³ãƒ¼ãƒ‰ã¯`Node`ã®å®Ÿè£…ã‚’ã‚‚ã¨ã«è¨˜è¿°ã—ã¦ã„ã¾ã™ãŒã€`LifecycleNode`ã‚‚åŒã˜æŒ¯ã‚‹èˆã„ã«ãªã£ã¦ã„ã¾ã™ã€‚

# å‰æçŸ¥è­˜

ã‚½ãƒ¼ã‚¹ã‚³ãƒ¼ãƒ‰ã‚’èª­ã¿å§‹ã‚ã‚‹å‰ã«ä¸‹è¨˜ã¯ç†è§£ã—ã¦ãŠãã¾ã—ã‚‡ã†ã€‚
æ—¢ã«çŸ¥ã£ã¦ã„ã‚‹æ–¹ã¯èª­ã¿é£›ã°ã—æ¨å¥¨ã€‚

## ãƒãƒ¼ãƒ‰ã¨ã¯ä½•ã‹ï¼Ÿï¼ˆãŠã•ã‚‰ã„ï¼‰
- ãƒãƒ¼ãƒ‰ã¯ã€ROS2ä¸Šã§å®Ÿè¡Œã™ã‚‹å‡¦ç†ã‚’æ‹…ã†æœ€ã‚‚åŸºæœ¬çš„ãªã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆï¼ˆè«–ç†å‡¦ç†å˜ä½ï¼‰ã§ã™ã€‚åˆå­¦è€…ã¯å‹˜é•ã„ã—ã‚„ã™ã„ã§ã™ãŒã€ãƒãƒ¼ãƒ‰ã¯å®Ÿè¡Œå¯èƒ½ãªãƒ—ãƒ­ã‚°ãƒ©ãƒ ï¼ˆ=executableï¼‰ã§ã¯ãªãã€executableã‚’å®Ÿè¡Œã™ã‚‹ã“ã¨ã§ç”Ÿæˆã•ã‚Œã‚‹ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆï¼ˆè«–ç†å‡¦ç†å˜ä½ï¼‰ã§ã™ã€‚
- é€šå¸¸ã€ROS2ã‚’ç”¨ã„ãŸã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã¯éå¸¸ã«å¤šæ•°ã®ãƒãƒ¼ãƒ‰ã®é€£ä¿‚å‹•ä½œã«ã‚ˆã£ã¦å®Ÿç¾ã—ã¾ã™ã€‚
- ãƒãƒ¼ãƒ‰ã¯ä»–ã®ãƒãƒ¼ãƒ‰ã¨ã€Œãƒˆãƒ”ãƒƒã‚¯ã€ã‚µãƒ¼ãƒ“ã‚¹ã€ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã€ãƒãƒ¼ãƒ‰ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã€ã‚’é€šã—ã¦é€šä¿¡ï¼ˆæƒ…å ±ã®ã‚„ã‚Šã¨ã‚Šï¼‰ã‚’è¡Œã„é€£æºå‹•ä½œã§ãã‚‹ã“ã¨ãŒç‰¹å¾´ã§ã™ã€‚
- ã‚ã‚‹ãƒãƒ¼ãƒ‰ã¨åˆ¥ã®ãƒãƒ¼ãƒ‰ã¯åŒã˜ãƒ—ãƒ­ã‚»ã‚¹ä¸Šã§å®Ÿè¡Œã™ã‚‹ã“ã¨ã‚‚ã€ç•°ãªã‚‹ãƒ—ãƒ­ã‚»ã‚¹ä¸Šã§å®Ÿè¡Œã™ã‚‹ã“ã¨ã‚‚ã€ã©ã¡ã‚‰ã‚‚å¯èƒ½ã§ã™
- ãƒãƒ¼ãƒ‰ã¯å¿…ãšexecutorã‚’ç”¨ã„ã¦è³‡æºï¼ˆã‚¹ãƒ¬ãƒƒãƒ‰ï¼‰ãŒå‰²ã‚Šå½“ã¦ã‚‰ã‚Œå®Ÿè¡Œã•ã‚Œã¾ã™ã€‚æ˜ç¤ºçš„ã«executorã‚’ä½¿ã£ã¦ã„ãªã„ã‚ˆã†ã«è¦‹ãˆã¦ã‚‚ã€è£ã§å¿…ãšexecutorãŒå‹•ã„ã¦ã¾ã™ã€‚executorã¯executableä¸Šã§å®Ÿè¡Œã•ã‚Œã¾ã™ã€‚

ãƒãƒ¼ãƒ‰ã¨ã¯ä½•ã‹ï¼Ÿç†è§£ãŒã‚ã‚„ãµã‚„ã§ã‚ã‚Œã°ä¸‹è¨˜è¨˜äº‹ã‚‚å‚è€ƒã«ã—ã¦ãã ã•ã„

https://zenn.dev/uedake/articles/ros2_concept

# å…¬å¼ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ

ãƒãƒ¼ãƒ‰å‘¨ã‚Šã‚’ç†è§£ã™ã‚‹ã®ã«å‚è€ƒã¨ãªã‚‹å…¬å¼ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã¯ã“ã®ã‚ãŸã‚Šã§ã™ãŒãƒ»ãƒ»ãƒ»ã€ã“ã‚Œã ã‘ã¯æ·±ã„ç†è§£ã¯ã§ãã¾ã›ã‚“ã€‚

- èª°ã‚‚ãŒæœ€åˆã«èª­ã‚€ã¨ã“ã‚
  - [Understanding-ROS2-Nodes](https://docs.ros.org/en/humble/Tutorials/Beginner-CLI-Tools/Understanding-ROS2-Nodes/Understanding-ROS2-Nodes.html)
  - ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã‹ã‚‰ã®ãƒãƒ¼ãƒ‰ã®æ‰±ã„ã¯ã“ã‚Œã§ã‚ã‹ã‚Šã¾ã™ã­ã€‚ã§ã‚‚å®Ÿéš›ã«ã‚·ã‚¹ãƒ†ãƒ é–‹ç™ºã—ã¦ã„ãã«ã¯ç‰©è¶³ã‚Šãªã„ã§ã™ã€‚
- ã“ã“ã‚‚èª­ã‚€ã®å¿…é ˆ
  - [Composition](https://docs.ros.org/en/humble/Tutorials/Intermediate/Composition.html)
  - å®Ÿå‹™çš„ã«ã¯Compositionã¨ã¦ã‚‚é‡è¦ã€‚ã§ã‚‚ã“ã“èª­ã‚“ã ã ã‘ã§ã¯ã€ã€‡ã€‡ã©ã†ãªã£ã¦ã‚‹ã®ï¼Ÿã¨ãŸãã•ã‚“ã®ç–‘å•ãŒæ²¸ãã¾ã™ã€‚
- APIãƒªãƒ•ã‚¡ãƒ¬ãƒ³ã‚¹
  - [Node](http://docs.ros.org/en/humble/p/rclcpp/generated/classrclcpp_1_1Node.html#classrclcpp_1_1Node)
  - ä¸è¦ªåˆ‡ã§ã™ã€‚æƒ…å ±é‡ãŒè¶³ã‚Šãªã„ã§ã™ã€‚

ç–‘å•ãŒæ²¸ã„ãŸã‚‰ã‚½ãƒ¼ã‚¹ã‚’èª­ã‚€ã—ã‹ãªã„ã§ã™ã€‚

# ã‚½ãƒ¼ã‚¹ã®ç¢ºèª

## Nodeã®å®Ÿè£…ã‚’ç†è§£ã™ã‚‹

ã¾ãšã€`Node`ã®privateãƒ¡ãƒ³ãƒã‚’è¦‹ã¦ã¿ã¾ã—ã‚‡ã†ã€‚ãŸãã•ã‚“ã®ã€‡ã€‡Interfaceã¸ã®ã‚¹ãƒãƒ¼ãƒˆãƒã‚¤ãƒ³ã‚¿ãŒä¸¦ã‚“ã§ã„ã¾ã™ã€‚

æ©Ÿèƒ½ã®å®Ÿè£…ãŒéå¸¸ã«æ•´ç†ã•ã‚Œã¦ãŠã‚Šåˆ†æ•£ã—ã¦å®šç¾©ã•ã‚Œã¦ã‚‹ã“ã¨ãŒã‚ã‹ã‚Šã¾ã™ã€‚ä¾‹ãˆã°ãƒãƒ¼ãƒ‰ãŒä»–ã®ãƒãƒ¼ãƒ‰ã‚„å¤–éƒ¨ã®ãƒ—ãƒ­ã‚°ãƒ©ãƒ ã¨é€£æºã™ã‚‹ç‚ºã®IFã§ã‚ã‚‹
- ãƒˆãƒ”ãƒƒã‚¯
- ã‚µãƒ¼ãƒ“ã‚¹
- ãƒãƒ¼ãƒ‰ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿

ã¨ã„ã£ãŸä»•çµ„ã¿ã¯ã€ãã‚Œãã‚Œåˆ¥ã‚¯ãƒ©ã‚¹ã§å®šç¾©ã•ã‚Œã¦ã„ã¾ã™ã€‚

[node.hpp](https://github.com/ros2/rclcpp/blob/humble/rclcpp/include/rclcpp/node.hpp)
```cpp:node.hppæŠœç²‹
private:
  RCLCPP_DISABLE_COPY(Node)

  rclcpp::node_interfaces::NodeBaseInterface::SharedPtr node_base_;
  rclcpp::node_interfaces::NodeGraphInterface::SharedPtr node_graph_;
  rclcpp::node_interfaces::NodeLoggingInterface::SharedPtr node_logging_;
  rclcpp::node_interfaces::NodeTimersInterface::SharedPtr node_timers_;
  rclcpp::node_interfaces::NodeTopicsInterface::SharedPtr node_topics_;
  rclcpp::node_interfaces::NodeServicesInterface::SharedPtr node_services_;
  rclcpp::node_interfaces::NodeClockInterface::SharedPtr node_clock_;
  rclcpp::node_interfaces::NodeParametersInterface::SharedPtr node_parameters_;
  rclcpp::node_interfaces::NodeTimeSourceInterface::SharedPtr node_time_source_;
  rclcpp::node_interfaces::NodeWaitablesInterface::SharedPtr node_waitables_;

  const rclcpp::NodeOptions node_options_;
  const std::string sub_namespace_;
  const std::string effective_namespace_;
```

æ¬¡ã«`Node`ã®constructorã‚’è¦‹ã¦ã¿ã¾ã—ã‚‡ã†ã€‚

- `node_ã€‡ã€‡`ã¨ã„ã†ãƒ¡ãƒ³ãƒå¤‰æ•°ï¼ˆã‚¹ãƒãƒ¼ãƒˆãƒã‚¤ãƒ³ã‚¿ï¼‰ã®å‚ç…§å…ˆãŒconstructæ™‚ã«åˆæœŸåŒ–ã•ã‚Œã¦ã„ã¾ã™ã€‚
  - ã¡ãªã¿ã«ã“ã®å‚ç…§å…ˆã¯ã“ã®ã‚¿ã‚¤ãƒŸãƒ³ã‚°ã§ç¢ºå®šã—ãã®å¾Œå¤‰ã‚ã‚‹ã“ã¨ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚
  - ãƒãƒ¼ãƒ‰ã¨å…±ã«å¿…ãšï¼‘å¯¾ï¼‘ã®é–¢ä¿‚ã§å­˜åœ¨ã—ã¾ã™ã®ã§ã€æ¦‚å¿µçš„ã«ã¯ãƒãƒ¼ãƒ‰ãã®ã‚‚ã®ã¨æ€ã£ã¦ã‚ˆã„ã§ã™ï¼ˆæ©Ÿèƒ½ã‚’åˆ†å‰²ã—ã¦å®šç¾©ã—ã¦ã„ã‚‹ã ã‘ï¼‰
- ä¾‹ãˆã°ãƒãƒ¼ãƒ‰ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã®ä»•çµ„ã¿ã¯ã€`Node`ã®ãƒ¡ãƒ³ãƒå¤‰æ•°`node_parameters_`ã‹ã‚‰å‚ç…§ã§ãã¾ã™ã€‚
  - `Node`ã‚’constructã—ãŸæ™‚ã«`node_parameters_`ã«ã¯å®Ÿä½“ã¨ã—ã¦`rclcpp::node_interfaces::NodeParametersInterface`ã‚’extendã—ã¦ã„ã‚‹`rclcpp::node_interfaces::NodeParameters`ãŒç”Ÿæˆã•ã‚Œä¿æŒã•ã‚Œã¾ã™

[node.cpp](https://github.com/ros2/rclcpp/blob/humble/rclcpp/src/rclcpp/node.cpp)
```cpp:node.cppæŠœç²‹
Node::Node(
  const std::string & node_name,
  const std::string & namespace_,
  const NodeOptions & options)
: node_base_(new rclcpp::node_interfaces::NodeBase(
      node_name,
      namespace_,
      options.context(),
      *(options.get_rcl_node_options()),
      options.use_intra_process_comms(),
      options.enable_topic_statistics())),
  node_graph_(new rclcpp::node_interfaces::NodeGraph(node_base_.get())),
  node_logging_(new rclcpp::node_interfaces::NodeLogging(node_base_.get())),
  node_timers_(new rclcpp::node_interfaces::NodeTimers(node_base_.get())),
  node_topics_(new rclcpp::node_interfaces::NodeTopics(node_base_.get(), node_timers_.get())),
  node_services_(new rclcpp::node_interfaces::NodeServices(node_base_.get())),
  node_clock_(new rclcpp::node_interfaces::NodeClock(
      node_base_,
      node_topics_,
      node_graph_,
      node_services_,
      node_logging_
    )),
  node_parameters_(new rclcpp::node_interfaces::NodeParameters(
      node_base_,
      node_logging_,
      node_topics_,
      node_services_,
      node_clock_,
      options.parameter_overrides(),
      options.start_parameter_services(),
      options.start_parameter_event_publisher(),
      // This is needed in order to apply parameter overrides to the qos profile provided in
      // options.
      get_parameter_events_qos(*node_base_, options),
      options.parameter_event_publisher_options(),
      options.allow_undeclared_parameters(),
      options.automatically_declare_parameters_from_overrides()
    )),
  node_time_source_(new rclcpp::node_interfaces::NodeTimeSource(
      node_base_,
      node_topics_,
      node_graph_,
      node_services_,
      node_logging_,
      node_clock_,
      node_parameters_,
      options.clock_qos(),
      options.use_clock_thread()
    )),
  node_waitables_(new rclcpp::node_interfaces::NodeWaitables(node_base_.get())),
  node_options_(options),
  sub_namespace_(""),
  effective_namespace_(create_effective_namespace(this->get_namespace(), sub_namespace_))
{
  // we have got what we wanted directly from the overrides,
  // but declare the parameters anyway so they are visible.
  rclcpp::detail::declare_qos_parameters(
    rclcpp::QosOverridingOptions
  {
    QosPolicyKind::Depth,
    QosPolicyKind::Durability,
    QosPolicyKind::History,
    QosPolicyKind::Reliability,
  },
    node_parameters_,
    node_topics_->resolve_topic_name("/parameter_events"),
    options.parameter_event_qos(),
    rclcpp::detail::PublisherQosParametersTraits{});
}
```

ä¸Šè¨˜constructorã‚’è¦‹ã¦ã‚ã‹ã‚‹ã®ãŒ`node_base_`ãŒã‹ãªã‚Šé‡è¦ãã†ã¨ã„ã†ã“ã¨ã€‚`node_ã€‡ã€‡`ã‚’åˆæœŸåŒ–ã™ã‚‹ã®ã«å¿…ãš`node_base_.get()`ãŒæ¸¡ã•ã‚Œã¦ã„ã‚‹ã“ã¨ã‹ã‚‰ã‚‚ãã®é‡è¦æ€§ãŒæ¨å¯Ÿã§ãã¾ã™ã€‚

ãªã®ã§æ¬¡ã«`rclcpp::node_interfaces::NodeBase`ã‚’ç†è§£ã—ã¾ã—ã‚‡ã†ã€‚

ãªãŠã€`node_base_`ã‚’åˆæœŸåŒ–ã™ã‚‹éš›ã«`options.get_rcl_node_options()`ãŒä½¿ç”¨ã•ã‚Œã¦ã„ã‚‹ã“ã¨ã‚‚é‡è¦ã§ã™ã€‚`options`ã¯ãƒãƒ¼ãƒ‰åˆæœŸåŒ–ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã§ã‚ã‚Šã€ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆæƒ…å ±ã‚’ä¿æŒã—ã¦ã„ã‚‹ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã§ã™ã€‚è©³ã—ãã¯åˆ¥è¨˜äº‹ã«ã¦è§£èª¬ã—ã¦ã„ã¾ã™ã€‚

https://zenn.dev/uedake/articles/ros2_node5_context


## NodeBaseã®å®Ÿè£…ã‚’ç†è§£ã™ã‚‹

`NodeBase`ã®privateãƒ¡ãƒ³ãƒã‚’è¦‹ã¦ã¿ã¾ã—ã‚‡ã†ã€‚é‡è¦ãªã®ã¯ãšã°ã‚Š

```cpp
std::shared_ptr<rcl_node_t> node_handle_;
```

ã“ã‚Œã¯`rcl_node_t`å‹ã¸ã®ã‚¹ãƒãƒ¼ãƒˆãƒã‚¤ãƒ³ã‚¿ã§ã™ã€‚
`node_handle_`ã¯ã€constructorä¸­ã§ä½œæˆã•ã‚Œã‚»ãƒƒãƒˆã•ã‚Œã¾ã™ã€‚

[node_base.hpp](https://github.com/ros2/rclcpp/blob/humble/rclcpp/include/rclcpp/node_interfaces/node_base.hpp)

```cpp:node_base.hppæŠœç²‹
private:
  RCLCPP_DISABLE_COPY(NodeBase)

  rclcpp::Context::SharedPtr context_;
  bool use_intra_process_default_;
  bool enable_topic_statistics_default_;

  std::shared_ptr<rcl_node_t> node_handle_;

  rclcpp::CallbackGroup::SharedPtr default_callback_group_;
  std::mutex callback_groups_mutex_;
  std::vector<rclcpp::CallbackGroup::WeakPtr> callback_groups_;

  std::atomic_bool associated_with_executor_;

  /// Guard condition for notifying the Executor of changes to this node.
  mutable std::recursive_mutex notify_guard_condition_mutex_;
  rclcpp::GuardCondition notify_guard_condition_;
  bool notify_guard_condition_is_valid_;
```

`NodeBase`ã®constructorã‚’è¦‹ã¾ã—ã‚‡ã†ã€‚rclãƒãƒ¼ãƒ‰ãŒä¸‹è¨˜ã®æ‰‹é †ã§ä½œæˆã•ã‚Œå‚ç…§ãŒè¨­å®šã•ã‚Œã¦ã„ã‚‹ã“ã¨ãŒã‚ã‹ã‚Šã¾ã™ã€‚rclãƒãƒ¼ãƒ‰ã¨ã¯ãƒãƒ¼ãƒ‰ã®æ©Ÿèƒ½ã®åŸºæœ¬éƒ¨åˆ†ï¼ˆãƒãƒ¼ãƒ‰ã®æœ¬ä½“ã¨è¨€ã£ã¦ã‚ˆã„ï¼‰ã§ã‚ã‚Šã€ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆè¨€èªï¼ˆc++ã‚„pythonï¼‰ã«ä¾å­˜ã—ãªã„cã§å®Ÿè£…ã•ã‚Œã¦ã„ã‚‹éƒ¨åˆ†ã§ã™ã€‚

1. rclãƒãƒ¼ãƒ‰ãŒ`new rcl_node_t()`ã§ä½œæˆã•ã‚Œã‚‹
2. `rcl_node_init()`ã«ã‚ˆã£ã¦rclãƒãƒ¼ãƒ‰ã®å¤‰æ•°ãŒè¨­å®šã•ã‚Œã‚‹
    - rclãƒãƒ¼ãƒ‰åˆæœŸåŒ–ã‚ªãƒ—ã‚·ãƒ§ãƒ³ï¼ˆå¼•æ•°`rcl_node_options`ã§æ¸¡ã•ã‚Œã‚‹ï¼‰ã‚‚`rcl_node_init()`ã«æ¸¡ã•ã‚Œã¾ã™
3. `node_handle_.reset()`ã«ã‚ˆã£ã¦`node_handle_`ã«å‚ç…§ãŒè¨­å®šã•ã‚Œã‚‹

[node_base.cpp](https://github.com/ros2/rclcpp/blob/humble/rclcpp/src/rclcpp/node_interfaces/node_base.cpp)

```cpp:node_base.cppæŠœç²‹
NodeBase::NodeBase(
  const std::string & node_name,
  const std::string & namespace_,
  rclcpp::Context::SharedPtr context,
  const rcl_node_options_t & rcl_node_options,
  bool use_intra_process_default,
  bool enable_topic_statistics_default)
: context_(context),
  use_intra_process_default_(use_intra_process_default),
  enable_topic_statistics_default_(enable_topic_statistics_default),
  node_handle_(nullptr),
  default_callback_group_(nullptr),
  associated_with_executor_(false),
  notify_guard_condition_(context),
  notify_guard_condition_is_valid_(false)
{
  // Create the rcl node and store it in a shared_ptr with a custom destructor.
  std::unique_ptr<rcl_node_t> rcl_node(new rcl_node_t(rcl_get_zero_initialized_node()));

  std::shared_ptr<std::recursive_mutex> logging_mutex = get_global_logging_mutex();

  rcl_ret_t ret;
  {
    std::lock_guard<std::recursive_mutex> guard(*logging_mutex);
    // TODO(ivanpauno): /rosout Qos should be reconfigurable.
    // TODO(ivanpauno): Instead of mutually excluding rcl_node_init with the global logger mutex,
    // rcl_logging_rosout_init_publisher_for_node could be decoupled from there and be called
    // here directly.
    ret = rcl_node_init(
      rcl_node.get(),
      node_name.c_str(), namespace_.c_str(),
      context_->get_rcl_context().get(), &rcl_node_options);
  }
  
  // ä¸­ç•¥
  
  node_handle_.reset(
    rcl_node.release(),
    [logging_mutex](rcl_node_t * node) -> void {
      std::lock_guard<std::recursive_mutex> guard(*logging_mutex);
      // TODO(ivanpauno): Instead of mutually excluding rcl_node_fini with the global logger mutex,
      // rcl_logging_rosout_fini_publisher_for_node could be decoupled from there and be called
      // here directly.
      if (rcl_node_fini(node) != RCL_RET_OK) {
        RCUTILS_LOG_ERROR_NAMED(
          "rclcpp",
          "Error in destruction of rcl node handle: %s", rcl_get_error_string().str);
      }
      delete node;
    });  
```

æ¬¡ã«rclãƒãƒ¼ãƒ‰ã‚’è¡¨ã™æ§‹é€ ä½“`rcl_node_t`ã‚’è¦‹ã¦ã„ãã¾ã—ã‚‡ã†ã€‚

## rclãƒãƒ¼ãƒ‰ã®å®Ÿè£…ã‚’ç†è§£ã™ã‚‹

ã“ã“ã‹ã‚‰ãƒ¬ãƒã‚¸ãƒˆãƒªãŒå¤‰ã‚ã‚Šã¾ã™ã€‚ä»Šã¾ã§ã¯rclcppãƒ¬ãƒã‚¸ãƒˆãƒªã®ä¸­ã‚’è¦‹ã¦ãã¾ã—ãŸãŒã€ã“ã“ã‹ã‚‰ã¯rclãƒ¬ãƒã‚¸ãƒˆãƒªã«ãªã‚Šã¾ã™ã€‚rclãƒãƒ¼ãƒ‰ã¯cè¨€èªã§å®Ÿè£…ã•ã‚Œã¦ã„ã¾ã™ã€‚

`rcl_node_t`æ§‹é€ ä½“ã®å®šç¾©ã‚’è¦‹ã¦ã¿ã¾ã—ã‚‡ã†ã€‚ã‚·ãƒ³ãƒ—ãƒ«ãªstructã§ã™ã€‚è¦‹ã¦ã‚ã‹ã‚‹ã‚ˆã†ã«`rcl_node_s`ã¯`rcl_node_impl_t`ã®ãƒ©ãƒƒãƒ‘ãƒ¼ã§ã™ã€‚

[node.h](https://github.com/ros2/rcl/blob/humble/rcl/include/rcl/node.h)

```c:node.hæŠœç²‹ï¼ˆæ§‹é€ ä½“å®šç¾©éƒ¨åˆ†ï¼‰
typedef struct rcl_node_impl_s rcl_node_impl_t;

/// Structure which encapsulates a ROS Node.
typedef struct rcl_node_s
{
  /// Context associated with this node.
  rcl_context_t * context;

  /// Private implementation pointer.
  rcl_node_impl_t * impl;
} rcl_node_t;
```

ã“ã®ä¸­ã§é‡è¦ãªã®ã¯`rcl_node_impl_t`æ§‹é€ ä½“ã¸ã®ãƒã‚¤ãƒ³ã‚¿`impl`ã§ã™ã€‚`rcl_node_impl_t`ã¯`rcl_node_impl_s`ã¨åŒç¾©ãªã®ã§ã€æ¬¡ã«`rcl_node_impl_s`ã®å®šç¾©ã‚’è¦‹ã¾ã—ã‚‡ã†ã€‚

[node.c](https://github.com/ros2/rcl/blob/humble/rcl/src/node.c)

```c:node.cæŠœç²‹ï¼ˆæ§‹é€ ä½“å®šç¾©éƒ¨åˆ†ï¼‰
struct rcl_node_impl_s
{
  rcl_node_options_t options;
  rmw_node_t * rmw_node_handle;
  rcl_guard_condition_t * graph_guard_condition;
  const char * logger_name;
  const char * fq_name;
};
```

`rcl_node_impl_s`æ§‹é€ ä½“ã§é‡è¦ãªã®ã¯`rmw_node_t`æ§‹é€ ä½“ã¸ã®ãƒã‚¤ãƒ³ã‚¿`rmw_node_handle`ã§ã™ã€‚

## rmwãƒãƒ¼ãƒ‰ã®å®Ÿè£…ã‚’ç†è§£ã™ã‚‹
rmwãƒãƒ¼ãƒ‰ã¨ã¯[RMW(Ros MiddleWare interface)](https://docs.ros.org/en/humble/p/rmw/generated/index.html)ãŒæä¾›ã™ã‚‹ãƒãƒ¼ãƒ‰å®Ÿè£…ã§ã™ã€‚ãƒãƒ¼ãƒ‰ãŒDDSã¨ã„ã†é€šä¿¡è¦æ ¼ã‚’ç”¨ã„ã¦ãƒãƒ¼ãƒ‰é–“ã§äº’ã„ã«é€šä¿¡ã‚’è¡Œãˆã‚‹ã‚ˆã†ã«ã—ã¦ãã‚Œã¦ã„ã¾ã™ã€‚

ä»Šã¾ã§è¦‹ã¦ããŸãƒ¬ãƒã‚¸ãƒˆãƒªï¼ˆrclcpp,rclï¼‰ã¨ã¯ã¾ãŸåˆ¥ã®rmwãƒ¬ãƒã‚¸ãƒˆãƒªã§ç®¡ç†ã•ã‚Œã¦ã„ã¾ã™ã€‚

`rmw_node_t`ã®å®šç¾©ã‚’è¦‹ã¦ã¿ã¾ã—ã‚‡ã†ã€‚

[rmw/types.h](https://github.com/ros2/rmw/blob/humble/rmw/include/rmw/types.h)

```c:rmw/types.hæŠœç²‹ï¼ˆæ§‹é€ ä½“å®šç¾©éƒ¨åˆ†ï¼‰
/// Structure which encapsulates an rmw node
typedef struct RMW_PUBLIC_TYPE rmw_node_s
{
  /// Name of the rmw implementation
  const char * implementation_identifier;

  /// Type erased pointer to this node's data
  void * data;

  /// A concise name of this rmw node for identification
  const char * name;

  /// The namespace of this rmw node
  const char * namespace_;

  /// Context information about node's init specific information
  rmw_context_t * context;
} rmw_node_t;
```

ãƒãƒ¼ãƒ‰ãŒä¸€æ„ã«è­˜åˆ¥ã™ã‚‹ç‚ºã®æƒ…å ±ã¨ã—ã¦nameã¨namespace_ã‚’æŒã£ã¦ã„ã‚‹ã“ã¨ãŒã‚ã‹ã‚Šã¾ã™ã€‚

## rclãƒãƒ¼ãƒ‰åˆæœŸåŒ–ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã‚’ç†è§£ã™ã‚‹
rclãƒãƒ¼ãƒ‰åˆæœŸåŒ–ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã¨ã¯ã€ãƒãƒ¼ãƒ‰åˆæœŸåŒ–ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã®ä¸€éƒ¨ã§ã™ã€‚ãƒãƒ¼ãƒ‰åˆæœŸåŒ–ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã¨ã¯ã€`Node`ã®constructorå¼•æ•°ã§ã‚ã‚‹`option`ã§æ¸¡ã•ã‚Œã‚‹å€¤ã‚’æŒ‡ã—ã€rclãƒãƒ¼ãƒ‰åˆæœŸåŒ–ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã¨ã¯ã€`NodeBase`ã®constructorå¼•æ•°ã§ã‚ã‚‹`rcl_node_options`ã§æ¸¡ã•ã‚Œã‚‹å€¤ã‚’æŒ‡ã—ã¾ã™ã€‚

ãƒãƒ¼ãƒ‰åˆæœŸåŒ–ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã¯ãƒãƒ¼ãƒ‰ã®è‰²ã€…ãªç®‡æ‰€ã«å½±éŸ¿ã—ã¾ã™ãŒã€ãã®ä¸­ã§ã‚‚rclãƒãƒ¼ãƒ‰åˆæœŸåŒ–ã‚ªãƒ—ã‚·ãƒ§ãƒ³éƒ¨åˆ†ã¯ãƒãƒ¼ãƒ‰ã®åŸºæœ¬çš„ãªæŒ¯ã‚‹èˆã„ã«å½±éŸ¿ã™ã‚‹ã®ã§é‡è¦ã§ã™ã€‚

rclãƒãƒ¼ãƒ‰åˆæœŸåŒ–ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã¯ã€ãƒãƒ¼ãƒ‰åˆæœŸåŒ–ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã‚’è¡¨ã™å¼•æ•°`option`ã‹ã‚‰`options.get_rcl_node_options()`ã«ã‚ˆã£ã¦ç”Ÿæˆã•ã‚Œ`NodeBase`ã®constructorã«æ¸¡ã•ã‚Œã¾ã™ã€‚

ã§ã¯`get_rcl_node_options()`ã®å®Ÿè£…ã‚’è¦‹ã¦ã¿ã¾ã—ã‚‡ã†ã€‚

[node_options.cpp](https://github.com/ros2/rclcpp/blob/humble/rclcpp/src/rclcpp/node_options.cpp)

```cpp:node_options.cpp
const rcl_node_options_t *
NodeOptions::get_rcl_node_options() const
{
  // If it is nullptr, create it on demand.
  if (!node_options_) {
    node_options_.reset(new rcl_node_options_t);
    *node_options_ = rcl_node_get_default_options();
    node_options_->allocator = this->allocator_;
    node_options_->use_global_arguments = this->use_global_arguments_;
    node_options_->enable_rosout = this->enable_rosout_;
    node_options_->rosout_qos = this->rosout_qos_.get_rmw_qos_profile();

    int c_argc = 0;
    std::unique_ptr<const char *[]> c_argv;
    if (!this->arguments_.empty()) {
      if (this->arguments_.size() > static_cast<size_t>(std::numeric_limits<int>::max())) {
        throw_from_rcl_error(RCL_RET_INVALID_ARGUMENT, "Too many args");
      }

      c_argc = static_cast<int>(this->arguments_.size());
      c_argv.reset(new const char *[c_argc]);

      for (std::size_t i = 0; i < this->arguments_.size(); ++i) {
        c_argv[i] = this->arguments_[i].c_str();
      }
    }

    rcl_ret_t ret = rcl_parse_arguments(
      c_argc, c_argv.get(), this->allocator_, &(node_options_->arguments));

    if (RCL_RET_OK != ret) {
      throw_from_rcl_error(ret, "failed to parse arguments");
    }

    std::vector<std::string> unparsed_ros_arguments = detail::get_unparsed_ros_arguments(
      c_argc, c_argv.get(), &(node_options_->arguments), this->allocator_);
    if (!unparsed_ros_arguments.empty()) {
      throw exceptions::UnknownROSArgsError(std::move(unparsed_ros_arguments));
    }
  }

  return node_options_.get();
}
```

æ³¨ç›®ã—ãŸã„ã®ã¯ã€`NodeOptions::get_rcl_node_options()`ãŒ`rcl_parse_arguments()`é–¢æ•°ã‚’å‘¼ã¶ç‚¹ã§ã™ã€‚ã“ã“ã§ã€executableèµ·å‹•æ™‚ã«æŒ‡å®šã§ãã‚‹ã‚³ãƒãƒ³ãƒ‰ãƒ©ã‚¤ãƒ³ROSå¼•æ•°ã‹ã‚‰ã‚°ãƒ­ãƒ¼ãƒãƒ«ROSå¼•æ•°ã‚’ç”Ÿæˆã™ã‚‹å‡¦ç†ãŒã•ã‚Œã¦ã„ã¾ã™ã€‚`rcl_parse_arguments`é–¢æ•°ã¯`rcl/src/rcl/arguments.c`ã§å®šç¾©ã•ã‚Œã¦ã„ã¾ã™ãŒã€è§£èª¬ã¯çœç•¥ã—ã¾ã™ã€‚

`get_rcl_node_options()`ã®æˆ»ã‚Šå€¤ã®å‹ã¯`rcl_node_options_t`æ§‹é€ ä½“ã¸ã®ãƒã‚¤ãƒ³ã‚¿ã§ã™ã€‚æ¬¡ã«ã€`rcl_node_options_t`ã®å®šç¾©ã‚’è¦‹ã¦ã¿ã¾ã—ã‚‡ã†ã€‚
 
[node_options.h](https://github.com/ros2/rcl/blob/humble/rcl/include/rcl/node_options.h)
```c:node_options.hæŠœç²‹
typedef struct rcl_node_options_s
{
  /// Custom allocator used for internal allocations.
  rcl_allocator_t allocator;

  /// If false then only use arguments in this struct, otherwise use global arguments also.
  bool use_global_arguments;

  /// Command line arguments that apply only to this node.
  rcl_arguments_t arguments;

  /// Flag to enable rosout for this node
  bool enable_rosout;

  /// Middleware quality of service settings for /rosout.
  rmw_qos_profile_t rosout_qos;
} rcl_node_options_t;
```

æ³¨ç›®ã—ãŸã„ã®ã¯`rcl_arguments_t`å‹ã§ã‚ã‚‹`arguments`ã§ã™ã€‚

`rcl_arguments_t`ã®å®šç¾©ã‚’è¦‹ã¦ã¿ã¾ã—ã‚‡ã†ã€‚
`rcl_arguments_t`æ§‹é€ ä½“ã¯`rcl_arguments_impl_s`æ§‹é€ ä½“ã®ãƒ©ãƒƒãƒ‘ãƒ¼ã‚ã‚‹ã“ã¨ãŒã‚ã‹ã‚Šã¾ã™ã€‚

[arguments.h](https://github.com/ros2/rcl/blob/humble/rcl/include/rcl/arguments.h)
```c:arguments.hæŠœç²‹
typedef struct rcl_arguments_impl_s rcl_arguments_impl_t;

/// Hold output of parsing command line arguments.
typedef struct rcl_arguments_s
{
  /// Private implementation pointer.
  rcl_arguments_impl_t * impl;
} rcl_arguments_t;
```

`rcl_arguments_impl_s`æ§‹é€ ä½“ã«ã¯ã€ä¸‹è¨˜ãŒå…¥ã£ã¦ã„ã¾ã™ã€‚ã“ã®æ§‹é€ ä½“ã¯ROSå¼•æ•°ã‚’è¡¨ã™æƒ…å ±ã§ã‚ã‚‹ã“ã¨ãŒã‚ã‹ã‚Šã¾ã™ã€‚

- `rcl_remap_t`å‹ã¸ã®ãƒã‚¤ãƒ³ã‚¿`remap_rules`
- `rcl_params_t`å‹ã¸ã®ãƒã‚¤ãƒ³ã‚¿`parameter_overrides`
  - executableå®Ÿè¡Œæ™‚ã«æŒ‡å®šã§ãã‚‹ROSå¼•æ•°ã®ï¼‘ã¤`--params-file <yaml_file_path>`ã§æŒ‡å®šã•ã‚ŒãŸyamlãƒ•ã‚¡ã‚¤ãƒ«ã‚’parseã—ãŸçµæœï¼ˆãƒãƒ¼ãƒ‰ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã®åˆæœŸå€¤ï¼‰ãŒæ›¸ãè¾¼ã¾ã‚Œã¦ã„ã‚‹

[arguments_impl.h](https://github.com/ros2/rcl/blob/humble/rcl/src/rcl/arguments_impl.h)

```c:arguments_impl.h
typedef struct rcl_arguments_impl_s
{
  /// Array of indices to unknown ROS specific arguments.
  int * unparsed_ros_args;
  /// Length of unparsed_ros_args.
  int num_unparsed_ros_args;

  /// Array of indices to non-ROS arguments.
  int * unparsed_args;
  /// Length of unparsed_args.
  int num_unparsed_args;

  /// Parameter override rules parsed from arguments.
  rcl_params_t * parameter_overrides;

  /// Array of yaml parameter file paths
  char ** parameter_files;
  /// Length of parameter_files.
  int num_param_files_args;

  /// Array of rules for name remapping.
  rcl_remap_t * remap_rules;
  /// Length of remap_rules.
  int num_remap_rules;

  /// Log levels parsed from arguments.
  rcl_log_levels_t log_levels;
  /// A file used to configure the external logging library
  char * external_log_config_file;
  /// A boolean value indicating if the standard out handler should be used for log output
  bool log_stdout_disabled;
  /// A boolean value indicating if the rosout topic handler should be used for log output
  bool log_rosout_disabled;
  /// A boolean value indicating if the external lib handler should be used for log output
  bool log_ext_lib_disabled;

  /// Enclave to be used.
  char * enclave;

  /// Allocator used to allocate objects in this struct
  rcl_allocator_t allocator;
} rcl_arguments_impl_t;
```


ãƒãƒ¼ãƒ‰ã®æ·±å €ã¯ã¨ã‚Šã‚ãˆãšã“ã“ã¾ã§è¦‹ã‚Œã°ååˆ†ã§ã™ã€‚

# ã¾ã¨ã‚

ã¤ã¾ã‚Šã€ãƒãƒ¼ãƒ‰ã®åŸºæœ¬æ§‹é€ ï¼ˆå¹¹ã¨ãªã‚‹éƒ¨åˆ†ï¼‰ã¯ä¸‹è¨˜ã®å›³ã®ã‚ˆã†ã«ãªã‚Šã¾ã™ã€‚
ã“ã®å¹¹ã®éƒ¨åˆ†ãŒã‚ã‹ã£ã¦ã„ã‚‹ã¨ã‚½ãƒ¼ã‚¹ãŒéå¸¸ã«èª­ã¿ã‚„ã™ããªã‚Šã¾ã™ã€‚

```mermaid
classDiagram
    Node *-- NodeBase : æ‰€æœ‰
    NodeBase *-- rcl_node_t : æ‰€æœ‰
    rcl_node_t *-- rcl_node_impl_t : æ‰€æœ‰
    rcl_node_impl_t *-- rmw_node_t : æ‰€æœ‰
    class Node{
      NodeBase node_base_
    }
    class NodeBase{
      rcl_node_t node_handle_
    }
    class rcl_node_t{
      rcl_node_impl_t impl
    }
    class rcl_node_impl_t{
      rmw_node_t rmw_node_handle
    }
    class rmw_node_t{
    }
```

`NodeBase`ã‚ˆã‚Šä¸Šã¯ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆæŒ‡å‘ã§ã‚³ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ã•ã‚Œã¦ã„ã‚‹ãŒã€`rcl_node_t`ä»¥ä¸‹ã¯é–¢æ•°ãƒ™ãƒ¼ã‚¹ã®ã‚³ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ãªã®ã§æ³¨æ„ï¼ˆrclä»¥ä¸‹ã¯èª­ã¿ã¥ã‚‰ã„ã§ã™ï¼‰

ãã‚Œãã‚Œã®ã–ã£ãã‚Šã¨ã—ãŸå½¹å‰²ã¯ä¸‹è¨˜ã§ã™ã€‚

- `Node`ã‚¯ãƒ©ã‚¹
  - ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆè¨€èªï¼ˆc++ï¼‰ã‹ã‚‰ãƒãƒ¼ãƒ‰ã‚’ç”Ÿæˆãƒ»æ“ä½œã™ã‚‹ç‚ºã®IFã‚’æä¾›ã™ã‚‹
  - ãƒãƒ¼ãƒ‰ãŒæŒã¤å„ç¨®æ©Ÿèƒ½ï¼ˆãƒˆãƒ”ãƒƒã‚¯é€šä¿¡, ã‚µãƒ¼ãƒ“ã‚¹é€šä¿¡, ãƒãƒ¼ãƒ‰ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ ç­‰ã€…ï¼‰ã®å®Ÿè£…ã¯ãã‚Œãã‚Œåˆ¥ã‚¯ãƒ©ã‚¹ã¸å§”è­²ã—ã¦ãŠã‚Šã€`Node`ã‚¯ãƒ©ã‚¹ã¯ãã‚Œã‚‰æ©Ÿèƒ½ã‚’é›†ç´„ã™ã‚‹ã‚¯ãƒ©ã‚¹ã¨ãªã£ã¦ã„ã‚‹ã€‚
- `NodeBase`ã‚¯ãƒ©ã‚¹
  - ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆè¨€èªï¼ˆc++ï¼‰ã‹ã‚‰ãƒãƒ¼ãƒ‰ã‚’æ“ä½œã™ã‚‹ç‚ºã®åŸºæœ¬æ©Ÿèƒ½ã‚’æä¾›ã™ã‚‹
  - ãƒãƒ¼ãƒ‰ãŒæŒã¤å„ç¨®æ©Ÿèƒ½ã®ä¸­ã§ã‚‚ã€æœ€ã‚‚åŸºæœ¬ã¨ãªã‚‹éƒ¨åˆ†ã‚’å®Ÿè£…ã€‚ãƒãƒ¼ãƒ‰åã‚„ãƒãƒ¼ãƒ‰åå‰ç©ºé–“ãªã©ãƒãƒ¼ãƒ‰ã‚’åŒºåˆ¥ã™ã‚‹ç‚ºã®å€¤ã‚„ãƒãƒ¼ãƒ‰é–“ã§é€šä¿¡ã™ã‚‹ç‚ºã®åŸºç¤å®Ÿè£…ã‚’ãƒ©ãƒƒãƒ—ã™ã‚‹ã€‚
- `rcl_node_t`æ§‹é€ ä½“, `rcl_node_impl_t`æ§‹é€ ä½“, åŠã³`rcl_node_init()`ç­‰ã®rclã®å„ç¨®é–¢æ•°
  - ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆè¨€èªï¼ˆc++,pythonç­‰ï¼‰ã«ä¾å­˜ã—ãªã„ãƒãƒ¼ãƒ‰ã®åŸºæœ¬æ©Ÿèƒ½ï¼ˆ=rclãƒãƒ¼ãƒ‰ï¼‰ã‚’æä¾›ã™ã‚‹ã€‚é‡è¦ãªã®ã¯`rcl_node_init()`é–¢æ•°ã§ã‚ã‚Šã€ãƒãƒ¼ãƒ‰ã‚’ç”Ÿæˆã™ã‚‹å‡¦ç†ã¨ã—ã¦ãƒãƒ¼ãƒ‰åã‚„ãƒãƒ¼ãƒ‰åå‰ç©ºé–“ã®ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ã‚„remapç­‰ã®å‡¦ç†ã‚’è¡Œã£ã¦ã„ã‚‹ã€‚`Node`ã¯ã“ã®`rcl_node_t`ã‚’ãƒ©ãƒƒãƒ—ã™ã‚‹å®Ÿè£…ã«ãªã£ã¦ã„ã‚‹ã€‚
- `rmw_node_t`æ§‹é€ ä½“åŠã³rmwã®å„ç¨®é–¢æ•°
  - ãƒãƒ¼ãƒ‰ãŒDDSã¨ã„ã†é€šä¿¡è¦æ ¼ã‚’ç”¨ã„ã¦äº’ã„ã«é€šä¿¡ã‚’è¡Œãˆã‚‹ã‚ˆã†ã«ã™ã‚‹æ©Ÿèƒ½ï¼ˆ=rmwãƒãƒ¼ãƒ‰ï¼‰ã‚’æä¾›ã™ã‚‹ã€‚`rcl_node_t`ã¯ã“ã®`rmw_node_t`ã‚’ãƒ©ãƒƒãƒ—ã™ã‚‹å®Ÿè£…ã«ãªã£ã¦ã„ã‚‹ã€‚

ã“ã“ã¾ã§ã‚ã‹ã£ã¦ã„ã‚Œã°ã€å€‹ã€…ã®å…·ä½“çš„ãªäº‹æƒ…ã«å¿œã˜ã¦æ°—ã«ãªã‚‹ã¨ã“ã‚ã‚’èª­ã‚“ã§ã„ãã“ã¨ã«ãªã‚Šã¾ã™ã€‚ãã‚Œã‚‰ã¯åˆ¥è¨˜äº‹ã«ã—ã¾ã™ï¼ˆé †æ¬¡è¿½åŠ äºˆå®šï¼‰

https://zenn.dev/uedake/articles/ros2_node2_name
https://zenn.dev/uedake/articles/ros2_node3_remap
https://zenn.dev/uedake/articles/ros2_node4_parameter