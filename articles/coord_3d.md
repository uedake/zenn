---
title: "3D座標系"
emoji: "📘"
type: "tech"
topics:
  - "math"
published: false
published_at: "2025-01-19 22:13"
---

# 3D　座標系

## オブジェクト座標系とワールド座標系

3Dオブジェクトの形状を記述している座標系をオブジェクト座標系と呼び、3Dオブジェクトを配置する空間（ワールド）を記述する座標系をワールド座標系と呼ぶ。

3Dオブジェクトをワールドへの配置の方法は、回転行列$R_o \in M_{3,3}$（姿勢と呼ぶ）とベクトル$t_o \in \R^3$（位置と呼ぶ）によって決まり、

- オブジェクト座標系で記述した3Dオブジェクトの点を$v'\in\R^3$
- ワールド座標系で記述した3Dオブジェクトの点を$v\in\R^3$

とすると、オブジェクト座標系の点を対応するワールド座標系の点に射影する関数$w:\R^3 \rightarrow \R^3$は下記となる。

$$
v = w(v') =R_o v'+t_o
$$

逆にワールド座標系の点をオブジェクト座標系の点に射影する関数$w^{-1}$は下記となる

$$
v' = w^{-1}(v) = R_o^{-1}(v-t_o) = R_o^{T}(v-t_o)
$$


- 補足
    - $R_o$を「姿勢」と呼んでいるが、この言葉は3Dオブジェクトの中心（バウンディングボックスの中心）がオブジェクト座標系の原点となるように記述されていることを前提とした呼び名である。
    - なぜなら、オブジェクト座標系の原点は$R_o$の値が変化してもワールド座標系上で移動しない「回転の中心」にあたる。3Dオブジェクトの中心がオブジェクト座標系の原点にあれば、$R_o$の値の変化は3Dオブジェクトの中心周りの回転を意味するので「姿勢」という言葉とよくマッチする。
    - 一方で3Dオブジェクトの中心がオブジェクト座標系の原点にない場合、$R_o$の値が変化によって3Dオブジェクトの中心はワールド座標系上で「移動」してしまうため「姿勢」という言葉の意味を超えた変化をしてしまう。

### オブジェクトの回転

オブジェクトの回転は回転行列で表され下記の２種類がある

- ワールド座標系基準での回転
- オブジェクト座標系基準での回転

ワールド座標系での位置tを中心とした回転行列$R$による回転を$f_{R,t}$と書くとすると、下記となる

$$
f_{R,t}(v) = R(v-t)+t
$$

一方で、オブジェクト座標系での位置tを中心とした回転行列$R$による回転を$f'_{R,t}$と書くとすると、下記となる

$$
\begin{split}
f'_{R,t}(v)
 = & w(R (w^{-1}(v)-t)+t) \\
 = & R_o (R (R_o^{T}(v-t_o)-t)+t) + t_o \\
 = & R_o R R_o^{T}(v-t_o)-R_o (R-E)t + t_o
\end{split}
$$

上記２つの回転$f_R,f'_R$はオブジェクトの姿勢$R_o=E$かつ位置$Rt_o=t_o$の場合にのみ一致し、一般には異なる。

### 回転$R$の表記法

回転を表す$R$は3x3の行列であるが正規直交行列であるという制約がある為、自由度は3しかない。そのため3つのスカラー値で表現することが可能である。代表的な方法としてオイラー角という表現方法がある。オイラー角は全部で12種類の異なる表現があるが以下ではxyzオイラー角を例に挙げて説明する。

xyzオイラー角とは、任意の回転を下記の３回連続のローカル座標系での回転で表す方法である
1. ローカル座標系の$x$軸周りに$α$[rad]回転
2. ローカル座標系の$y$軸周りに$β$[rad]回転
3. ローカル座標系の$z$軸周りに$γ$[rad]回転

ローカル座標系とは、最初はワールド座標系と軸の向きが等しい状態で始まるが回転に伴って一緒に回転する座標系のことである。

点$v$について
1. ローカル座標系の$x$軸周りに$α$[rad]回転させると下記になる
    - R_x(α)v
2. 上記をローカル座標系の$y$軸周りに$β$[rad]回転させると下記になる
    - R_x(α)R_y(β)v
3. 上記をローカル座標系の$z$軸周りに$γ$[rad]回転させると下記になる
    - R_x(α)R_y(β)R_z(γ)v

上記を$v$を$R$で回転させた点$Rv$と等しくなると考えると下記が成り立つ。

$$
R = R_x(α)R_y(β)R_z(γ)
$$

即ち、$(α,β,γ)$を用いて$R$を表現できる。またこれは下記の３回連続のワールド座標系での回転を行うことと等しい

1. ワールド座標系の$z$軸周りに$γ$[rad]回転
2. ワールド座標系の$y$軸周りに$β$[rad]回転
3. ワールド座標系の$x$軸周りに$α$[rad]回転


なお$R_x(θ),R_y(θ),R_y(θ)$はそれぞれx,y,z軸周りの回転を表す回転行列である
$$
 R_x(θ)
 =
 \begin{bmatrix}
  cos(θ) & -sin(θ) & 0 \\
  sin(θ) & cos(θ) & 0 \\
  0 & 0 & 1 
 \end{bmatrix}
$$
$$
 R_y(θ)
 =
 \begin{bmatrix}
  cos(θ) & 0 & sin(θ)  \\
  0 & 1 & 0 \\
  -sin(θ) & 0 & cos(θ) 
 \end{bmatrix}
$$
$$
 R_z(θ)
 =
 \begin{bmatrix}
  1 & 0 & 0 \\
  0 & cos(θ) & -sin(θ) \\
  0 & sin(θ) & cos(θ)
 \end{bmatrix}
$$

### 姿勢$R_o$の表記法

姿勢を表す$R_o$についても上記と同様にxyzオイラー角で表記することができ、その角度を$(α_o,β_o,γ_o)$とすると、下記となる。

$$
R_o = R_x(α_o)R_y(β_o)R_z(γ_o)
$$
