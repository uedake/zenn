---
title: "é€è¦–æŠ•å½±å¤‰æ›"
emoji: "ğŸ“˜"
type: "tech"
topics:
  - "math"
  - "perspective transformation"
  - "projective transformation"
published: false
---

# è§£èª¬å¯¾è±¡

æœ¬è¨˜äº‹ã§ã¯ã€é€è¦–æŠ•å½±ï¼ˆperspective projectionï¼‰å¤‰æ›ã«ã¤ã„ã¦è§£èª¬ã—ã¾ã™ã€‚é€è¦–æŠ•å½±å¤‰æ›ã¯å˜ã«å°„å½±å¤‰æ›ï¼ˆprojective transformationï¼‰ã¨ã‚‚å‘¼ã°ã‚Œã‚‹ã“ã¨ãŒã‚ã‚Šã¾ã™ãŒã€å˜ã«å°„å½±ã ã¨æ­£å°„å½±/ç›´äº¤å°„å½±ï¼ˆorthographic projectionï¼‰ã¨ç”¨èªãŒæ··ä¹±ã™ã‚‹ã®ã§æœ¬è¨˜äº‹ã§ã¯é€è¦–æŠ•å½±å¤‰æ›ã¨å‘¼ã³ã¾ã™ã€‚

é€è¦–æŠ•å½±å¤‰æ›ã¯ã€3æ¬¡å…ƒä¸Šã®ç‚¹ã‚’ãƒ”ãƒ³ãƒ›ãƒ¼ãƒ«ã‚«ãƒ¡ãƒ©ãƒ¢ãƒ‡ãƒ«ã«ã‚ˆã£ã¦2æ¬¡å…ƒä¸Šã«æŠ•å½±ã—ãŸç‚¹ã‚’æ±‚ã‚ã‚‹å¤‰æ›ã§ã™ã€‚

## å®šç¾©

é€è¦–æŠ•å½±å¤‰æ›ã®ä¸­ã§ã‚‚ç‰¹ã«ãƒ”ãƒ³ãƒ›ãƒ¼ãƒ«ã‚«ãƒ¡ãƒ©ã®ä¸­å¿ƒï¼ˆãƒ”ãƒ³ãƒ›ãƒ¼ãƒ«ï¼‰ãŒåŸç‚¹ã«ä½ç½®ã—ã€å…‰è»¸ãŒzè»¸å‘ãã§ã€æŠ•å½±é¢ãŒz=1ã®å¹³é¢ã§ã‚ã‚‹å°„å½±å¤‰æ›ã‚’æ¨™æº–çš„ãªé€è¦–æŠ•å½±å¤‰æ›ã¨ã—ã¦è€ƒãˆã‚‹ã€‚

3æ¬¡å…ƒä¸Šã®ç‚¹$\bm{v}=\begin{bmatrix} x \\ y \\ z   \end{bmatrix}$(ãŸã ã—$z>0$)ã‚’z=1ã®å¹³é¢ä¸Šã®ç‚¹$\begin{bmatrix} x' \\ y' \\ 1 \end{bmatrix}$ã«ä¸‹è¨˜é–¢æ•°$\bm{f}_{pp}: \R^3 \rightarrow \R^3$ã§å†™ã™å¤‰æ›ã‚’ï¼ˆz=1å¹³é¢ã¸ã®ï¼‰é€è¦–æŠ•å½±å¤‰æ›ã¨å‘¼ã¶ã€‚

$$
\bm{f}_{pp}(\bm{v})
= \begin{bmatrix}
    x / z \\
    y / z \\
    1
  \end{bmatrix}
\tag{1}
$$ 

ã‚‚ã—ãã¯ã€zåº§æ¨™ã‚’ç„¡è¦–ã—ã€2æ¬¡å…ƒç©ºé–“ã¸å°„å½±ã™ã‚‹é–¢æ•°$\bm{F}_{pp}: \R^3 \rightarrow \R^2$ã‚’é€è¦–æŠ•å½±å¤‰æ›ã¨å‘¼ã¶ã€‚

$$
\bm{F}_{pp}(\bm{v})
= \begin{bmatrix}
    x / z \\
    y / z
  \end{bmatrix}
\tag{1'}
$$ 

## é€è¦–æŠ•å½±å¤‰æ›ã®å…‰ç·šå¹³è¡ŒåŒ–å¤‰æ›ã¨æ­£å°„å½±å¤‰æ›ã¸ã®åˆ†è§£

é€è¦–æŠ•å½±å¤‰æ›$\bm{f}_{pp}$ã¯ã€ä¸‹è¨˜ï¼’ã¤ã®å¤‰æ›ã‚’é †ã«è¡Œã£ãŸå¤‰æ›ã¨ã—ã¦åˆ†è§£ã§ãã‚‹ã€‚

- å…‰ç·šå¹³è¡ŒåŒ–å¤‰æ›$\bm{f}_{rp}: \R^3 \rightarrow \R^3$
- æ­£å°„å½±å¤‰æ›$\bm{f}_{op}: \R^3 \rightarrow \R^3$

å…‰ç·šå¹³è¡ŒåŒ–å¤‰æ›ã¨ã¯ã€åŸç‚¹ã‚’é€šã‚‹ç›´ç·šï¼ˆãƒ”ãƒ³ãƒ›ãƒ¼ãƒ«ã‚«ãƒ¡ãƒ©ã®ä¸­å¿ƒã‚’é€šã‚‹å…‰ç·šï¼‰ç¾¤ã‚’å¹³è¡Œãªç›´ç·šç¾¤ã«ç§»ã™å¤‰æ›ã§ã‚ã‚Šã€ï¼ˆç‰¹ã«zè»¸ã«å¹³è¡Œã§è·é›¢ã‚’ä¿å­˜ã™ã‚‹ï¼‰å…‰ç·šå¹³è¡ŒåŒ–å¤‰æ›$\bm{f}_{rp}$ã¯ä¸‹è¨˜ã§å®šç¾©ã•ã‚Œã‚‹ã€‚

$$
\bm{f}_{rp}(\bm{v})
= \begin{bmatrix}
    x / z \\
    y / z \\
    |\bm{v}|
  \end{bmatrix}
\tag{2}
$$ 

ã¾ãŸã€ï¼ˆzè»¸æ–¹å‘ã¸ã®ï¼‰æ­£å°„å½±å¤‰æ›$\bm{f}_{op}$ã¯ã€ä¸‹è¨˜ã§å®šç¾©ã•ã‚Œã‚‹ã€‚

$$
\bm{f}_{op}(\bm{v})
= P_3 \bm{v}
\tag{3}
$$ 
$$
P_3 = 
\begin{bmatrix}
    1 & 0 & 0 \\
    0 & 1 & 0 \\
    0 & 0 & 0
\end{bmatrix}
$$ 

ã“ã®$\bm{f}_{rp}$ã¨$\bm{f}_{op}$ã‚’ä½¿ãˆã°é€è¦–æŠ•å½±å¤‰æ›$\bm{f}_{pp}$ã¯ä¸‹è¨˜ã§æ±‚ã¾ã‚‹ã€‚

$$
\begin{split}
\bm{f}_{pp}(\bm{v})
& = \bm{f}_{op}(\bm{f}_{rp}(\bm{v}))
+ \begin{bmatrix} 
    0 \\
    0 \\
    1
  \end{bmatrix} \\
& = P_3\bm{f}_{rp}(\bm{v})
+ \begin{bmatrix} 
    0 \\
    0 \\
    1
  \end{bmatrix}
\end{split}
\tag{4}
$$ 

ã¤ã¾ã‚Šã€é€è¦–æŠ•å½±å¤‰æ›ã¯ã€å…‰ç·šå¹³è¡ŒåŒ–å¤‰æ›ã—ãŸå¾Œã«æ­£å°„å½±å¤‰æ›ã™ã‚‹ã“ã¨ã¨ï¼ˆzè»¸æ–¹å‘ã¸ã®å¹³è¡Œç§»å‹•åˆ†ã‚’é™¤ãï¼‰ç­‰ã—ã„ã€‚

é€è¦–æŠ•å½±å¤‰æ›$\bm{f}_{pp}$ã¯ã€ãƒ¤ã‚³ãƒ“è¡Œåˆ—ãŒæ­£å‰‡ã§ãªãæ‰±ã„ã¥ã‚‰ã„ãŒã€å…‰ç·šå¹³è¡ŒåŒ–å¤‰æ›$\bm{f}_{rp}$ã¯ãƒ¤ã‚³ãƒ“è¡Œåˆ—ãŒæ­£å‰‡ã§æ‰±ã„ã‚„ã™ã„ã¨ã„ã†ç‰¹å¾´ãŒã‚ã‚‹ã€‚

ãªãŠã€é€è¦–æŠ•å½±å¤‰æ›ã‚’2æ¬¡å…ƒã¸ã®å°„å½±$\bm{F}_{pp}$ã¨ã—ã¦è¨˜è¿°ã™ã‚‹å ´åˆã¯ã€æ­£å°„å½±å¤‰æ›ã‚’2æ¬¡å…ƒã¸ã®å°„å½±$\bm{F}_{op}$ã¨ã—ã¦ä¸‹è¨˜ã§å®šç¾©ã™ã‚‹ã€‚

$$
\bm{F}_{op}(\bm{v})
= P_2 \bm{v}
\tag{3'}
$$ 
$$
P_2 = 
\begin{bmatrix}
    1 & 0 & 0 \\
    0 & 1 & 0
\end{bmatrix}
$$ 

ã“ã®$\bm{f}_{rp}$ã¨$\bm{F}_{op}$ã‚’ä½¿ãˆã°é€è¦–æŠ•å½±å¤‰æ›$\bm{F}_{pp}$ã¯ä¸‹è¨˜ã§æ±‚ã¾ã‚‹ã€‚

$$
\begin{split}
\bm{F}_{pp}(\bm{v})
& = \bm{F}_{op}(\bm{f}_{rp}(\bm{v})) \\
& = P_2\bm{f}_{rp}(\bm{v})
\end{split}
\tag{4'}
$$ 


## ãƒ¤ã‚³ãƒ“è¡Œåˆ—ã‚’ç”¨ã„ãŸè¿‘ä¼¼

1. å…‰ç·šå¹³è¡ŒåŒ–å¤‰æ›ã‚’ï¼ˆæ­£å‰‡ãªï¼‰ã‚¢ãƒ•ã‚£ãƒ³å¤‰æ›ã§è¿‘ä¼¼ã§ãã‚‹ã“ã¨
2. é€è¦–æŠ•å½±å¤‰æ›ã‚’ï¼ˆæ­£å‰‡ã§ãªã„ï¼‰ã‚¢ãƒ•ã‚£ãƒ³å¤‰æ›ã§è¿‘ä¼¼ã§ãã‚‹ã“ã¨

ã‚’é †ã«ç¤ºã™ã€‚

â€»ã‚¢ãƒ•ã‚£ãƒ³å¤‰æ›ã¨ã¯ç·šå½¢å¤‰æ›ã¨å¹³è¡Œç§»å‹•ã®åˆæˆã§å®Ÿç¾ã§ãã‚‹å¤‰æ›

### å…‰ç·šå¹³è¡ŒåŒ–å¤‰æ›ã‚’ã‚¢ãƒ•ã‚£ãƒ³å¤‰æ›ã§è¿‘ä¼¼

å…‰ç·šå¹³è¡ŒåŒ–å¤‰æ›$\bm{f}_{rp}$ã®ãƒ¤ã‚³ãƒ“è¡Œåˆ—ã‚’$J_{\bm{v}}  \in M_{3,3}$ã¨æ›¸ãã¨

$$
J_{\bm{v}}
= \frac{\partial \bm{f}_{rp}}{\partial \bm{v}}
= \begin{bmatrix}
    1/z & 0 & -x/z^2 \\
    0 & 1/z & -y/z^2 \\
    x/|\bm{v}| & y/|\bm{v}| & z/|\bm{v}|
  \end{bmatrix}
\tag{5}
$$

ãƒ¤ã‚³ãƒ“è¡Œåˆ—ã‚’ç”¨ã„ã‚‹ã¨ã€ã‚ã‚‹ç‚¹$\bm{v_0} = \begin{bmatrix} x_0 \\ y_0 \\ z_0 \end{bmatrix}$(ãŸã ã—$z_0\neq0$)å‘¨ã‚Šã®å±€æ‰€é ˜åŸŸ$\bm{v}=\bm{v_0}+\delta \bm{v}$ã§ã¯ã€

$$
\begin{split}
\bm{f}_{rp}(\bm{v})
& = \bm{f}_{rp}(\bm{v_0}) + J_{\bm{v_0}}(\bm{v}-\bm{v_0}) \\
& = \begin{bmatrix}
    x_0 / z_0 \\ y_0 / z_0 \\ |\bm{v_0}|
  \end{bmatrix}
  +
  \begin{bmatrix}
    1/z_0 & 0 & -x_0/{z_0}^2 \\
    0 & 1/z_0 & -y_0/{z_0}^2 \\
    x_0/|\bm{v_0}| & y_0/|\bm{v_0}| & z_0/|\bm{v_0}|
  \end{bmatrix}
  (\bm{v}-\bm{v_0}) \\
& = \begin{bmatrix}
    x_0 / z_0 \\ y_0 / z_0 \\ 0
  \end{bmatrix}
  +
  \begin{bmatrix}
    1/z_0 & 0 & -x_0/{z_0}^2 \\
    0 & 1/z_0 & -y_0/{z_0}^2 \\
    x_0/|\bm{v_0}| & y_0/|\bm{v_0}| & z_0/|\bm{v_0}|
  \end{bmatrix}
  \bm{v}
\end{split}
\tag{6}
$$ 

ã¨è¿‘ä¼¼ã§ãã‚‹ã€‚

ã“ã‚Œã¯ã€ã‚ã‚‹ç‚¹$\bm{v_0}$å‘¨ã‚Šã®å±€æ‰€é ˜åŸŸ$\bm{v}=\bm{v_0}+\delta \bm{v}$ã§ã¯ã€å…‰ç·šå¹³è¡ŒåŒ–å¤‰æ›ã‚’æ­£å‰‡ãªã‚¢ãƒ•ã‚£ãƒ³å¤‰æ›ã§è¿‘ä¼¼ã§ãã‚‹ã“ã¨ã‚’æ„å‘³ã™ã‚‹ã€‚

æ­£å‰‡ã§ã‚ã‚‹ã“ã¨ã¯ã€

$$
  |J_{\bm{v}}| = \begin{vmatrix}
    1/z & 0 & -x/{z}^2 \\
    0 & 1/z & -y/{z}^2 \\
    x/|\bm{v}| & y/|\bm{v}| & z/|\bm{v}|
  \end{vmatrix}
  = \frac{x^2+y^2+z^2}{z^3|\bm{v}|}
  = \frac{|\bm{v}|}{z^3}
  \neq 0
\tag{7}
$$ 

ã‚ˆã‚Šã‚ã‹ã‚‹

ãªãŠã€$J_{\bm{v}}$ã®é€†è¡Œåˆ—ã¯ä¸‹è¨˜ã§ã‚ã‚‹

$$
J_{\bm{v}}^{-1}
= \begin{bmatrix}
    z(1-x^2/|\bm{v}|^2) & -xyz/|\bm{v}|^2 & x/|\bm{v}| \\
    -xyz/|\bm{v}|^2 & z(1-y^2/|\bm{v}|^2) & y/|\bm{v}| \\
    -xz^2/|\bm{v}|^2 & -yz^2/|\bm{v}|^2 & z/|\bm{v}|
  \end{bmatrix}
$$


### é€è¦–æŠ•å½±å¤‰æ›ã‚’ã‚¢ãƒ•ã‚£ãƒ³å¤‰æ›ã§è¿‘ä¼¼

(6)å¼ã®è¿‘ä¼¼ã‚’(4)å¼ã«ä»£å…¥ã™ã‚‹ã¨

$$
\begin{split}
\bm{f}_{pp}(\bm{v})
& = P_3\bm{f}_{rp}(\bm{v})
+ \begin{bmatrix} 
    0 \\
    0 \\
    1
  \end{bmatrix} \\
& = P_3
  \begin{bmatrix}
    1/z_0 & 0 & -x_0/{z_0}^2 \\
    0 & 1/z_0 & -y_0/{z_0}^2 \\
    x_0/|\bm{v_0}| & y_0/|\bm{v_0}| & z_0/|\bm{v_0}|
  \end{bmatrix}
  \bm{v}
+ P_3
  \begin{bmatrix}
    x_0 / z_0 \\ y_0 / z_0 \\ 0
  \end{bmatrix}
+ \begin{bmatrix} 
    0 \\
    0 \\
    1
  \end{bmatrix} \\
& =
  \begin{bmatrix}
    1/z_0 & 0 & -x_0/{z_0}^2 \\
    0 & 1/z_0 & -y_0/{z_0}^2 \\
    0 & 0 & 0
  \end{bmatrix}
  \bm{v}
+ \begin{bmatrix}
    x_0 / z_0 \\ y_0 / z_0 \\ 1
  \end{bmatrix}
\end{split}
\tag{8}
$$ 

ã“ã‚Œã¯ã€ã‚ã‚‹ç‚¹$\bm{v_0}$å‘¨ã‚Šã®å±€æ‰€é ˜åŸŸ$\bm{v}=\bm{v_0}+\delta \bm{v}$ã§ã¯ã€é€è¦–æŠ•å½±å¤‰æ›ã‚’ï¼ˆæ­£å‰‡ã§ãªã„ï¼‰ã‚¢ãƒ•ã‚£ãƒ³å¤‰æ›ã§è¿‘ä¼¼ã§ãã‚‹ã“ã¨ã‚’æ„å‘³ã™ã‚‹ã€‚

## æ¥•å††ä½“ã«å¯¾ã™ã‚‹é€è¦–æŠ•å½±å¤‰æ›

3æ¬¡å…ƒã®æ¥•å††ä½“ã‚’é€è¦–æŠ•å½±å¤‰æ›ã—ãŸå ´åˆã®2æ¬¡å…ƒå¹³é¢ä¸Šã®å›³å½¢ã¯å³å¯†ã«ã¯æ¥•å††ã«ã¯ãªã‚‰ãªã„ã€‚ã—ã‹ã—ã€ä¸Šè¨˜è¿‘ä¼¼ã®ã‚‚ã¨ã§ã¯ã€3æ¬¡å…ƒç©ºé–“ä¸Šã®æ¥•å††ä½“ã¯2æ¬¡å…ƒç©ºé–“ã®æ¥•å††ã«å°„å½±ã•ã‚Œã‚‹ã€‚

ãã®ã“ã¨ã‚’ä¸‹è¨˜ã®é †ã§ç¤ºã™
1. æ¥•å††ä½“ã‚’å…‰ç·šå¹³è¡ŒåŒ–å¤‰æ›ã™ã‚‹ã¨ï¼ˆè¿‘ä¼¼ã®ã‚‚ã¨ã§ï¼‰æ¥•å††ä½“ã¨ãªã‚‹ã“ã¨
2. æ¥•å††ä½“ã‚’æ­£å°„å½±å¤‰æ›ã™ã‚‹ã¨æ¥•å††ã¨ãªã‚‹ã“ã¨

ä¸Šè¨˜ï¼’ã¤ã‚’ç¤ºã›ã‚Œã°ã€æ¥•å††ä½“ã‚’é€è¦–æŠ•å½±å¤‰æ›ã™ã‚‹ã¨ï¼ˆè¿‘ä¼¼ã®ã‚‚ã¨ã§ï¼‰æ¥•å††ã¨ãªã‚‹ã“ã¨ã‚’ç¤ºã—ãŸã“ã¨ã«ãªã‚‹ã€‚

### æ¥•å††ä½“ã«å¯¾ã™ã‚‹å…‰ç·šå¹³è¡ŒåŒ–å¤‰æ›

ä¸­å¿ƒã‚’$\bm{v_0}$ã¨ã™ã‚‹3æ¬¡å…ƒç©ºé–“ä¸Šã®ä»»æ„ã®æ¥•å††ä½“ã®è¡¨é¢ã‚’æ§‹æˆã™ã‚‹ç‚¹$\bm{v_{cylinder}} \in \R^3$ã¯ã€æ¥•å††ä½“ã®å½¢ã‚’æ±ºã‚ã‚‹ï¼ˆæ­£å‰‡ãªï¼‰å¯¾ç§°è¡Œåˆ—$M \in M_{3,3}$ã‚’ç”¨ã„ã¦ä¸‹è¨˜å¼ã§ã‚ã‚‰ã‚ã›ã‚‹ã€‚

$$
(\bm{v_{cylinder}}-\bm{v_0})^TM(\bm{v_{cylinder}}-\bm{v_0})
= 1
\tag{9}
$$

3æ¬¡å…ƒã®æ¥•å††ä½“ã‚’å…‰ç·šå¹³è¡ŒåŒ–å¤‰æ›$\bm{f}_{rp}$ã§å¤‰æ›ã—ãŸç‚¹$\bm{v_{cylinder}}'=\bm{f}_{rp}(\bm{v_{cylinder}})$ãŒ(6)å¼ã®è¿‘ä¼¼ã®ã‚‚ã¨ã§æˆã™å½¢ã¯
- ä¸­å¿ƒ$\bm{v_0}'=\bm{f}_{rp}(\bm{v_0})$
- å½¢ã‚’æ±ºã‚ã‚‹å¯¾ç§°è¡Œåˆ—$M'={{J_{\bm{v_0}}}^{-1}}^{T}M{{J_{\bm{v_0}}}}^{-1}$

ã®æ¥•å††ä½“ã¨ãªã‚‹ãŒã€ãã®ã“ã¨ã‚’ç¢ºèªã—ã¦ã¿ã‚‹ã€‚

#### è¨¼æ˜

ä¸‹è¨˜å¼(10)ãŒæˆã‚Šç«‹ã¤ã“ã¨ã‚’ç¢ºèªã™ã‚Œã°ã‚ˆã„

$$
(\bm{f}_{rp}(\bm{v_{cylinder})}-\bm{f}_{rp}(\bm{v_0}))^T{{J_{\bm{v_0}}}^{-1}}^{T}M{{J_{\bm{v_0}}}}^{-1}(\bm{f}_{rp}(\bm{v_{cylinder})}-\bm{f}_{rp}(\bm{v_0})) = 1
\tag{10}
$$

å¼(5)ã‚ˆã‚Š$\bm{v_0}$ã®è¿‘å‚ã«é™ã‚Œã°

$$
\bm{f}_{rp}(\bm{v_{cylinder}}) - \bm{f}_{rp}(\bm{v_0})
= J_{\bm{v_0}}(\bm{v_{cylinder}}-\bm{v_0})
\tag{11}
$$

ãŒæˆã‚Šç«‹ã¤ã€‚(10)å¼ã®å·¦è¾ºã‚’(11)å¼ã¨(9)å¼ã‚’ç”¨ã„ã¦å¤‰å½¢ã™ã‚‹ã¨ã€

$$
\begin{split}
& (\bm{f}_{rp}(\bm{v_{cylinder})}-\bm{f}_{rp}(\bm{v_0}))^T{{J_{\bm{v_0}}}^{-1}}^{T}M{{J_{\bm{v_0}}}}^{-1}(\bm{f}_{rp}(\bm{v_{cylinder})}-\bm{f}_{rp}(\bm{v_0})) \\
& = (\bm{v_{cylinder}}-\bm{v_0})^T{J_{\bm{v_0}}}^{T}{{J_{\bm{v_0}}}^{-1}}^{T}M{J_{\bm{v_0}}}^{-1}{J_{\bm{v_0}}}(\bm{v_{cylinder}}-\bm{v_0}) \\
& = (\bm{v_{cylinder}}-\bm{v_0})^TM(\bm{v_{cylinder}}-\bm{v_0}) \\
& = 1 
\end{split}
\tag{12}
$$

ã¨ãªã‚Šç¢ºã‹ã«(10)å¼ãŒæˆã‚Šç«‹ã£ã¦ã„ã‚‹ã€‚

### æ¥•å††ä½“ã«å¯¾ã™ã‚‹æ­£å°„å½±å¤‰æ›

ä¸­å¿ƒãŒ$\bm{v}_0'$ã§å½¢ã‚’æ±ºã‚ã‚‹å¯¾ç§°è¡Œåˆ—ãŒ$M'$ã®æ¥•å††ä½“ï¼ˆï¼“æ¬¡å…ƒå›³å½¢ï¼‰ã®è¡¨é¢ã‚’æ§‹æˆã™ã‚‹ç‚¹$\bm{v}'$

$$
(\bm{v}'-\bm{v}_0')^TM'(\bm{v}'-\bm{v}_0') = 1
\tag{13}
$$


ã‚’zæ–¹å‘ã®æ­£å°„å½±$f_o$ã§å¤‰æ›ã—ãŸz=0å¹³é¢ä¸Šã®ç‚¹$\bm{v}''$

$$
\bm{v}'' = \bm{f}_{op}(\bm{v}') = P_3 \bm{v}'
\tag{14}
$$

ã®åŒ…çµ¡ç·šä¸Šã®ç‚¹$\bm{v}''_{envelope}$ãŒæ¥•å††ã¨ãªã£ã¦ã„ã‚‹ã‹ã‚’ç¢ºèªã™ã‚‹ã€‚ã“ã‚ŒãŒç¢ºèªã§ãã‚Œã°å¼(7)ã§æ±ºã¾ã‚‹æ¥•å††ä½“ã‚’å¼(3)ã§å¤‰æ›ã—ãŸå›³å½¢ï¼ˆã™ãªã‚ã¡ä»»æ„ã®æ¥•å††ä½“ã‚’é€è¦–æŠ•å½±å¤‰æ›ã—ãŸå›³å½¢ï¼‰ãŒæ¥•å††ã§ã‚ã‚‹ã“ã¨ã‚’ç¤ºã›ã‚‹ã€‚

$\bm{v}''_{envelope}$ãŒxyå¹³é¢ä¸Šã®æ¥•å††ã§ã‚ã‚‹ã“ã¨ã‚’ç¤ºã™ã«ã¯ã€ã‚ã‚‹ãƒ©ãƒ³ã‚¯ãŒï¼’ã§ã‚ã‚‹è¡Œåˆ—$M'' \in M_{3,3}$ï¼ˆ3è¡Œç›®ã®è¦ç´ ãŒå…¨ã¦0ã‹ã¤3åˆ—ç›®ã®è¦ç´ ãŒå…¨ã¦0ã¨ã™ã‚‹ï¼‰ã¨ãƒ™ã‚¯ãƒˆãƒ«$\bm{v}_0''=P_3\bm{v}_0'$ã‚’ç”¨ã„ã¦ã€ä¸‹è¨˜å¼ãŒæˆã‚Šç«‹ã¤ã“ã¨ã‚’ç¤ºã›ã°ã‚ˆã„

$$
(\bm{v}''_{envelope}-\bm{v}_0'')^TM''(\bm{v}''_{envelope}-\bm{v}_0'')
= 1
\tag{15}
$$

ãªãŠ$M''$ã¯ã€3è¡Œç›®ã®è¦ç´ ãŒå…¨ã¦0ã‹ã¤3åˆ—ç›®ã®è¦ç´ ãŒå…¨ã¦0ã®è¡Œåˆ—ã§ã‚ã‚‹ã®ã§ä¸‹è¨˜ãŒæˆã‚Šç«‹ãŸãªã‘ã‚Œã°ã„ã‘ãªã„ã€‚

$$
M'' 
\begin{bmatrix} 
  0 \\
  0 \\
  1
\end{bmatrix}
= 0
\tag{16}
$$
$$
\begin{bmatrix} 
  0 & 0 & 1
\end{bmatrix}
M'' 
= 0
\tag{17}
$$
$$
M'' 
P_3
= M''
\tag{18}
$$
$$
P_3
M'' 
= M''
\tag{19}
$$

ã¾ãŸã€æ¥•å††ä½“ï¼ˆï¼“æ¬¡å…ƒå›³å½¢ï¼‰ã®è¡¨é¢ã‚’æ§‹æˆã™ã‚‹ç‚¹$\bm{v}'$ã®æ³•ç·šãƒ™ã‚¯ãƒˆãƒ«ã¯$M'(\bm{v}'-\bm{v}_0')$ã§ä¸ãˆã‚‰ã‚Œã‚‹ã€‚ã“ã®ã“ã¨ã¯

$$
\bm{g}(\bm{v}')=(\bm{v}'-\bm{v}_0')^TM'(\bm{v}'-\bm{v}_0')
\tag{20}
$$

ã®å…¨å¾®åˆ†ã‚’0ã¨ãŠã„ãŸä¸‹è¨˜å¼ã‹ã‚‰ç›´ã¡ã«ã‚ã‹ã‚‹

$$
d\bm{g}(\bm{v}')
=\frac{\partial \bm{g}(\bm{v}')}{\partial \bm{v}'} \cdot d\bm{v}'
=2M'(\bm{v}'-\bm{v}_0') \cdot d\bm{v}'
=0
\tag{21}
$$

æ­£å°„å½±ã•ã‚Œã‚‹ã¨åŒ…çµ¡ç·šä¸Šã®ç‚¹$\bm{v}''_{envelope}$ã«ãªã‚‹ã‚ˆã†ãª$\bm{v}'=\bm{v}'_{envelope}$ã¯ã€æ³•ç·šãƒ™ã‚¯ãƒˆãƒ«ã®zæˆåˆ†ãŒ0ã§ã‚ã‚‹ç‚¹ã®é›†åˆã§ã‚ã‚‹ã®ã§ä¸‹è¨˜ã‚’æº€ãŸã™ã€‚

$$
\begin{bmatrix} 
  0 & 0 & 1
\end{bmatrix}

M'(\bm{v}'_{envelope}-\bm{v}_0')
=0
\tag{22}
$$

#### è¨¼æ˜
ä»¥ä¸‹(15)å¼ãŒæˆã‚Šç«‹ã¤ã“ã¨ã‚’ç¤ºã—ã¦ã„ãã€‚ã¾ãš$M''$ã‚’ã‚ã‚‹è¡Œåˆ—$N \in M_{3,3}$ã‚’ç”¨ã„ã¦

$$
M'' = M' - N
\tag{23}
$$

ã¨ç½®ã„ã¦ã¿ã‚‹ã€‚

(23)å¼ã«(16)å¼ãƒ»(17)å¼ã‚’å½“ã¦ã¯ã‚ã‚‹ã¨ä¸‹è¨˜ãŒæˆã‚Šç«‹ã¤å¿…è¦ãŒã‚ã‚‹ã€‚

$$
M'
\begin{bmatrix} 
  0 \\
  0 \\
  1
\end{bmatrix}
=
N
\begin{bmatrix} 
  0 \\
  0 \\
  1
\end{bmatrix}
\tag{24}
$$

$$
\begin{bmatrix} 
  0 & 0 & 1
\end{bmatrix}
M'
=
\begin{bmatrix} 
  0 & 0 & 1
\end{bmatrix}
N
\tag{25}
$$

ã“ã“ã§(24)å¼ãƒ»(25)å¼ãŒæˆã‚Šç«‹ã¤$N$ã¯ä¸‹è¨˜ã¨ã‹ã‘ã‚‹ã“ã¨ãŒã‚ã‹ã‚‹ï¼ˆå®Ÿéš›ã«å·¦å³ã‹ã‚‰$\begin{bmatrix}0 & 0 & 1\end{bmatrix}$ã‚‚ã—ãã¯$\begin{bmatrix}0 & 0 & 1\end{bmatrix}^T$ã‚’ã‹ã‘ã¦ã¿ã‚‹ã“ã¨ã§å®¹æ˜“ã«ç¢ºã‹ã‚ã‚‰ã‚Œã‚‹ï¼‰

$$
N
=
\frac{
M'
\begin{bmatrix} 
  0 \\
  0 \\
  1
\end{bmatrix}
\begin{bmatrix} 
  0 & 0 & 1
\end{bmatrix}
M'
}{
\begin{bmatrix} 
  0 & 0 & 1
\end{bmatrix}
M'
\begin{bmatrix} 
  0 \\
  0 \\
  1
\end{bmatrix}
}
\tag{26}
$$

ã•ã‚‰ã«ã€ã“ã®$N$ã¯(22)å¼ã‚ˆã‚Šä¸‹è¨˜ã‚’æº€ãŸã™ã“ã¨ãŒã‚ã‹ã‚‹ã€‚

$$
N(\bm{v}'_{envelope}-\bm{v}_0')=0
\tag{27}
$$


ã“ã“ã§(15)å¼ã®å·¦è¾ºã‚’(14)(18)(19)(23)(27)å¼ã‚’ä½¿ç”¨ã—ã¦ç½®ãæ›ãˆ,æœ€å¾Œã«(13)å¼ã®$\bm{v}'$ã«$\bm{v}'_{envelope}$ã‚’ä»£å…¥ã—ãŸå¼ã‚’ä»£å…¥ã—ã¦ã¿ã‚Œã°

$$
\begin{split}
(\bm{p}_{envelope}-\bm{v}_0'')^TM''(\bm{p}_{envelope}-\bm{v}_0'')
= & (\bm{v}'_{envelope}-\bm{v}_0')^TP_3M''P_3(\bm{v}'_{envelope}-\bm{v}_0') \\
= & (\bm{v}'_{envelope}-\bm{v}_0')^TM''(\bm{v}'_{envelope}-\bm{v}_0') \\
= & (\bm{v}'_{envelope}-\bm{v}_0')^T(M'-N)(\bm{v}'_{envelope}-\bm{v}_0') \\
= & (\bm{v}'_{envelope}-\bm{v}_0')^TM'(\bm{v}'_{envelope}-\bm{v}_0') \\
= & 1
\end{split}
\tag{27}
$$

ã¨ãªã‚Šç¢ºã‹ã«(15)å¼ãŒæº€ãŸã•ã‚Œã‚‹ã“ã¨ãŒç¤ºã›ãŸã€‚

ã™ãªã‚ã¡ã€ä¸­å¿ƒãŒ$\bm{v}_0'$ã§å½¢ã‚’æ±ºã‚ã‚‹å¯¾ç§°è¡Œåˆ—ãŒ$M'$ã®æ¥•å††ä½“ã¯ã€(zæ–¹å‘ã¸ã®)æ­£å°„å½±ã«ã‚ˆã£ã¦ä¸‹è¨˜ã®æ¥•å††ã¨ãªã‚‹ã“ã¨ãŒã‚ã‹ã£ãŸã€‚

- ä¸­å¿ƒ$\bm{v}_0''=P_3\bm{v}_0'$
- å½¢ã‚’æ±ºã‚ã‚‹å¯¾ç§°è¡Œåˆ—$M''
= M' -
\frac{
M'
\begin{bmatrix} 
  0 & 0 & 0\\
  0 & 0 & 0 \\
  0 & 0 & 1
\end{bmatrix}
M'
}{
\begin{bmatrix} 
  0 & 0 & 1
\end{bmatrix}
M'
\begin{bmatrix} 
  0 \\
  0 \\
  1
\end{bmatrix}
}
$

### æ¥•å††ä½“ã«å¯¾ã™ã‚‹é€è¦–æŠ•å½±å¤‰æ›

é€è¦–æŠ•å½±å¤‰æ›ã¯ã€å…‰ç·šå¹³è¡ŒåŒ–å¤‰æ›ã¨æ­£å°„å½±å¤‰æ›ã®åˆæˆã§ã‚ã‚‹ã®ã§ã€é †ã«é©ç”¨ã™ã‚Œã°ã‚ˆã„ã€‚

ä¸‹è¨˜ã®ä»»æ„ã®æ¥•å††ä½“ã¯
- ä¸­å¿ƒ$\bm{v_0}$
- å½¢ã‚’æ±ºã‚ã‚‹å¯¾ç§°è¡Œåˆ—$M$

ã¾ãšå…‰ç·šå¹³è¡ŒåŒ–å¤‰æ›$\bm{f}_{rp}$ã«ã‚ˆã‚Šä¸‹è¨˜ã®æ¥•å††ä½“ã«ï¼ˆè¿‘ä¼¼çš„ã«ï¼‰å¤‰æ›ã•ã‚Œã‚‹
- ä¸­å¿ƒ$\bm{v_0}'=\bm{f}_{rp}(\bm{v_0})$
- å½¢ã‚’æ±ºã‚ã‚‹å¯¾ç§°è¡Œåˆ—$M'={{J_{\bm{v_0}}}^{-1}}^{T}M{{J_{\bm{v_0}}}}^{-1}$

ã•ã‚‰ã«æ­£å°„å½±å¤‰æ›$\bm{f}_{op}$ã«ã‚ˆã‚Šä¸‹è¨˜ã®æ¥•å††ã«å¤‰æ›ã•ã‚Œã‚‹
- ä¸­å¿ƒ$\bm{v}_0''=P_3\bm{v}_0'=P_3\bm{f}_{rp}(\bm{v_0})$
- å½¢ã‚’æ±ºã‚ã‚‹å¯¾ç§°è¡Œåˆ—$M''
= M' -
\frac{
M'
\begin{bmatrix} 
  0 & 0 & 0\\
  0 & 0 & 0 \\
  0 & 0 & 1
\end{bmatrix}
M'
}{
\begin{bmatrix} 
  0 & 0 & 1
\end{bmatrix}
M'
\begin{bmatrix} 
  0 \\
  0 \\
  1
\end{bmatrix}
}
= {{J_{\bm{v_0}}}^{-1}}^{T}
(M - \frac{
M\bm{v_0}\bm{v_0}^TM
}{
\bm{v_0}^{T}M\bm{v_0}
})
{{J_{\bm{v_0}}}}^{-1}
$

## 3æ¬¡å…ƒã‚¬ã‚¦ã‚¹é–¢æ•°ã§æ±ºã¾ã‚‹å¯†åº¦å€¤ã®é€è¦–æŠ•å½±å¤‰æ›

3æ¬¡å…ƒç©ºé–“ä¸Šã«ã€æ¥•å††ä½“ã®ä¸é€æ˜åº¦ã‚’æŒã¤ç²’å­ï¼ˆã‚¬ã‚¦ã‚¹ç²’å­ï¼‰ã‚’è€ƒãˆã‚‹ã€‚ã“ã®ç²’å­ã¯ä¸­å¿ƒã‚’è¦³æ¸¬ã—ãŸå ´åˆã«ã¯ä¸é€æ˜åº¦ãŒ1ï¼ˆå®Œå…¨ã«ä¸é€æ˜ï¼‰ã§ã‚ã‚Šã€ä¸­å¿ƒã‹ã‚‰ãšã‚ŒãŸä½ç½®ã‚’è¦³æ¸¬ã—ãŸå ´åˆã€ä¸­å¿ƒã‹ã‚‰é›¢ã‚Œã‚Œã‚‹ã»ã©ã«ä¸é€æ˜åº¦ãŒä¸‹ãŒã‚Šï¼ˆé€æ˜åº¦ãŒã‚ãŒã‚Šï¼‰å¾Œã‚ã«ã‚ã‚‹ãƒ¢ãƒã‹ã‚‰ã®å…‰ãŒè¦‹ãˆã‚‹ã¨ã™ã‚‹ã€‚ã“ã®ä¸é€æ˜åº¦ã‚’ä¸‹è¨˜ã®é€šã‚Šãƒ¢ãƒ‡ãƒ«åŒ–ã—ã¦å®šç¾©ã™ã‚‹ã€‚

### ã‚¬ã‚¦ã‚¹ç²’å­ã®å®šç¾©

ã‚¬ã‚¦ã‚¹ç²’å­ã¯3æ¬¡å…ƒç©ºé–“ä¸Šã«åºƒãŒã£ã¦ãŠã‚Šãã®ä½ç½®ã«å¿œã˜ãŸå¯†åº¦$D_{3d}: \R^3 \rightarrow \R$ã‚’æœ‰ã—ã€ãã®å¯†åº¦ã¯ç²’å­ã®ä¸­å¿ƒ$v_0 \in R^3$ã§æœ€å¤§ã¨ãªã‚Šã€ä¸­å¿ƒã‹ã‚‰$v \in R^3$é›¢ã‚ŒãŸä½ç½®ã§ã¯3æ¬¡å…ƒã‚¬ã‚¦ã‚¹é–¢æ•°ï¼ˆåˆ†æ•£å…±åˆ†æ•£è¡Œåˆ—ã‚’$Î£ \in M_{3,3}$ã¨ã™ã‚‹ï¼‰ã«å¾“ã£ã¦æ¸›è¡°ã™ã‚‹ã‚‚ã®ã¨ã™ã‚‹ã€‚ã™ãªã‚ã¡ã€

$$
D_{3d}(\bm{v})
= G_3(\bm{v};\bm{v}_0,Î£)
= \frac{1}{\sqrt{(2\pi)^3|Î£|}}
\Large
ğ‘’^{-\frac{1}{2}(\bm{v}-\bm{v}_0)^TÎ£^{-1}(\bm{v}-\bm{v}_0)}
\tag{28}
$$

ã“ã®å¯†åº¦ã¨ã¯èƒŒæ™¯ã«ã‚ã‚‹ãƒ¢ãƒã‹ã‚‰ã®å…‰ã‚’é€šã—ã«ãã•ã‚’è¡¨ã—ã€ä¸é€æ˜åº¦ã‚’è¨ˆç®—ã™ã‚‹ãŸã‚ã«å®šç¾©ã™ã‚‹æ¦‚å¿µã§ã‚ã‚‹ã€‚

ç²’å­ã‚’åŸç‚¹ã«ç©´ãŒã‚ã‚‹ãƒ”ãƒ³ãƒ›ãƒ¼ãƒ«ã‚«ãƒ¡ãƒ©ã§è¦³æ¸¬ã—ãŸæ™‚ã®ä¸é€æ˜åº¦ã‚’è€ƒãˆã‚‹æº–å‚™ã®ç‚ºã€ãƒ”ã‚¯ã‚»ãƒ«åº§æ¨™å€¤ã®æ–‰æ¬¡åº§æ¨™$\hat{\bm{p}}=(p_x,p_y,1)$ã¨ã‚«ãƒ¡ãƒ©åº§æ¨™$\bm{v_c} \in \R^3$ã®å¯¾å¿œä»˜ã‘ã‚’ã‚«ãƒ¡ãƒ©å†…éƒ¨ãƒ‘ãƒ©ãƒ¡ãƒ¼ãƒ©ã¨å‘¼ã¶è¡Œåˆ—$K \in M_{3,3}$ã‚’ç”¨ã„ã¦ä¸‹è¨˜ã§å®šç¾©ã™ã‚‹ã€‚ãªãŠã€ã‚«ãƒ¡ãƒ©åº§æ¨™ã¨ã¯ç”»ç´ ã‚’é€šã‚‹å…‰ãŒ$z=1$ã®å¹³é¢ã¨äº¤ã‚ã‚‹ç‚¹ã‚’è¡¨ã™åº§æ¨™ã§ã‚ã‚‹ã€‚

$$
\hat{\bm{p}} = K \bm{v_c} \\
\tag{29}
$$
$$
K  = \begin{bmatrix}
    f_x & 0 & p_{x0}\\
    0 & f_y & p_{y0}\\
    0 & 0 & 1
    \end{bmatrix}
$$
$$
K^{-1}  = \begin{bmatrix}
    1/f_x & 0 & -p_{x0}/f_x\\
    0 & 1/f_y & -p_{y0}/f_y\\
    0 & 0 & 1
    \end{bmatrix}
$$

ä¸Šè¨˜ã«ãŠã‘ã‚‹$f_x,f_y$ã¯ãƒ”ã‚¯ã‚»ãƒ«é–“è·é›¢ï¼ˆç”»ç´ ãƒ”ãƒƒãƒï¼‰å˜ä½ã§ã®ç„¦ç‚¹è·é›¢ã§ã‚ã‚Šã€ç„¦ç‚¹è·é›¢$f$ã€xæ–¹å‘ç”»ç´ ãƒ”ãƒƒãƒ$PitchX$ã€yæ–¹å‘ç”»ç´ ãƒ”ãƒƒãƒ$PitchY$ã‹ã‚‰ä¸‹è¨˜ã§å®šã¾ã‚‹å€¤ã§ã‚ã‚‹ã€‚

$$
f_x = f/PitchX \\
f_y = f/PitchY
$$

ã¾ãŸã€åŸç‚¹åŠã³ç©ºé–“ä¸Šã®ç‚¹$\bm{v}\in \R^3$ã‚’é€šã‚‹å…‰ç·šã‚’$Ray(\bm{v})$ã¨å‘¼ã¶ã“ã¨ã¨ã™ã‚‹

ä»¥ä¸Šã§æº–å‚™ãŒæ•´ã£ãŸã®ã§ã€ã‚«ãƒ¡ãƒ©åº§æ¨™$\bm{v_c}$ã§è¦³æ¸¬ã•ã‚Œã‚‹ç²’å­ã®ä¸é€æ˜åº¦$Î±(\bm{v_c})$ã‚’ä¸‹è¨˜ã§å®šç¾©ã™ã‚‹ã€‚

$$
Î±(\bm{v}_c) = C\int_{Ray(\bm{v}_c)} D_{3d}(\bm{v}) ds
\tag{30}
$$

ã“ã“ã§$ds$ã¯ç·šç´ ã§ã‚ã‚Š$ds=|d\bm{v}|$ã§ã‚ã‚‹ã€‚$C$ã¯ã€ä¸é€æ˜åº¦ã®å€¤ã®æœ€å¤§å€¤ã‚’1ã«ã™ã‚‹ãŸã‚ã®å®šæ•°ã§ã‚ã‚Šã€ä¸‹è¨˜ã§å®šç¾©ã™ã‚‹ã€‚

$$
C = \frac{1}{\int_{Ray(\bm{v}_0)} D_{3d}(\bm{v}) ds}
\tag{31}
$$

ä¸Šè¨˜(31)å¼ã®ç©åˆ†ã‚’å…‰ç·šå¹³è¡ŒåŒ–å¤‰æ›$\bm{f}_{rp}$ã«ã‚ˆã‚‹å¤‰æ›ã—ãŸãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿$\bm{v}'=\bm{f}_{rp}(\bm{v})$ã§æ›¸ãç›´ã™ã¨

$$
\begin{split}
Î±(\bm{v}_c)
= & C\int_{0}^{\infty}{D_{3d}(f_{rp}^{-1}(\bm{v}'))}|\frac{\partial v}{\partial z'}|dz' \\
= & C\int_{0}^{\infty}{D_{3d}(f_{rp}^{-1}(\bm{v}'))}dz'
\end{split}
\tag{31}
$$

ã¨ã‹ã‘ã‚‹ã€‚(31)å¼ã¯ç©åˆ†ç¯„å›²$(0,\infty)$ã‚’$(-\infty,\infty)$ã§è¿‘ä¼¼ã—ã€ã•ã‚‰ã«è¿‘ä¼¼$J_{\bm{v_0}}^{-1}(\bm{v}'- \bm{v}_0') = \bm{v}-\bm{v_0}$
ã‚’ç”¨ã„$dz'$ã®ç©åˆ†ã‚’è¨ˆç®—ã™ã‚‹ã¨ä¸‹è¨˜ã«æ›¸ãæ›ãˆã‚‰ã‚Œã‚‹ã€‚

$$
\begin{split}
Î±(\bm{v}_c)
= & \frac{C}{\sqrt{(2\pi)^3|Î£|}}
    \int_{-\infty}^{\infty}
    \Large
    ğ‘’^{-\frac{1}{2}(\bm{v}'-\bm{v}'_0)^T(J_{\bm{v_0}}Î£J_{\bm{v}_0}^T)^{-1}(\bm{v}'-\bm{v}'_0)}
    \normalsize
    dz' \\
= & C\sqrt{\frac{|J_{\bm{v}_0}Î£J_{\bm{v_0}}^T|}{|Î£|}}
  \int_{-\infty}^{\infty} G_3(\bm{v}';\bm{v}'_0,J_{\bm{v}_0}Î£J_{\bm{v_0}}^T)
    dz' \\
= &
  C||J_{\bm{v}_0}||
  G_2(K \bm{v_c};P_2\bm{v}'_0,P_2J_{\bm{v_0}}Î£J_{\bm{v_0}}^TP_2^T) \\
\end{split}
$$
ãªãŠã€å®šæ•°Cã¯
$$
C = \frac{1}{
  ||J_{\bm{v}_0}||
  G_2(K \bm{v_0};P_2\bm{v}'_0,P_2J_{\bm{v_0}}Î£J_{\bm{v_0}}^TP_2^T)}
  = \frac{1}{||J_{\bm{v}_0}||}\\
$$
ã§ã‚ã‚‹ã‹ã‚‰ã€æœ€çµ‚çš„ã«ä¸‹è¨˜ã¨ãªã‚‹
$$
Î±(\bm{v}_c)
= G_2(K \bm{v_c};P_2\bm{v}'_0,P_2J_{\bm{v_0}}Î£J_{\bm{v_0}}^TP_2^T) \\
$$
